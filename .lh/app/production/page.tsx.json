{
    "sourceFile": "app/production/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1763069565217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763361124631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,36 +1,231 @@\n+\"use client\";\r\n+\r\n+import { useEffect, useState } from \"react\";\r\n+import { createSupabaseClient } from \"@/lib/supabase/client\";\r\n import { Card } from \"@/components/ui/card\";\r\n+import { Badge } from \"@/components/ui/badge\";\r\n import { ProductionWorkflowForm } from \"@/components/production/workflow-form\";\r\n-import { productionBatches } from \"@/lib/sample-data\";\r\n+import { StartBatchDialog } from \"@/components/production/start-batch-dialog\";\r\n+import { Plus } from \"lucide-react\";\r\n \r\n+type ProductionBatch = {\r\n+  id: string;\r\n+  batch_code: string;\r\n+  phase: \"dehusking\" | \"pressing\" | \"bottling\";\r\n+  farmer_name: string | null;\r\n+  batch_date: string;\r\n+  input_groundnuts_kg: number | null;\r\n+  output_peanuts_kg: number | null;\r\n+  output_oil_liters: number | null;\r\n+  output_oilcake_kg: number | null;\r\n+  output_husk_kg: number | null;\r\n+  bottled_units: number | null;\r\n+  notes: string | null;\r\n+};\r\n+\r\n export default function ProductionPage() {\r\n-  const upcoming = productionBatches.filter((batch) => batch.phase !== \"bottling\");\r\n+  const [batches, setBatches] = useState<ProductionBatch[]>([]);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [showStartDialog, setShowStartDialog] = useState(false);\r\n+  const [selectedBatch, setSelectedBatch] = useState<ProductionBatch | null>(null);\r\n+  const supabase = createSupabaseClient();\r\n \r\n+  const fetchBatches = async () => {\r\n+    setLoading(true);\r\n+    const { data, error } = await supabase\r\n+      .from(\"production_batches\")\r\n+      .select(\"*\")\r\n+      .order(\"batch_date\", { ascending: false });\r\n+\r\n+    if (!error && data) {\r\n+      setBatches(data);\r\n+    }\r\n+    setLoading(false);\r\n+  };\r\n+\r\n+  useEffect(() => {\r\n+    fetchBatches();\r\n+\r\n+    // Subscribe to real-time changes\r\n+    const channel = supabase\r\n+      .channel(\"production-changes\")\r\n+      .on(\r\n+        \"postgres_changes\",\r\n+        { event: \"*\", schema: \"public\", table: \"production_batches\" },\r\n+        () => {\r\n+          fetchBatches();\r\n+        }\r\n+      )\r\n+      .subscribe();\r\n+\r\n+    return () => {\r\n+      supabase.removeChannel(channel);\r\n+    };\r\n+  }, []);\r\n+\r\n+  const dehuskingBatches = batches.filter((b) => b.phase === \"dehusking\");\r\n+  const pressingBatches = batches.filter((b) => b.phase === \"pressing\");\r\n+  const bottlingBatches = batches.filter((b) => b.phase === \"bottling\");\r\n+\r\n   return (\r\n     <div className=\"space-y-6\">\r\n-      <div>\r\n-        <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">Production Run Planner</h2>\r\n-        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n-          Log each stage to keep inventory, costing, and compliance aligned.\r\n-        </p>\r\n+      <div className=\"flex items-center justify-between\">\r\n+        <div>\r\n+          <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+            Production Workflow\r\n+          </h2>\r\n+          <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n+            Kanban-style workflow for phased production tracking.\r\n+          </p>\r\n+        </div>\r\n+        <button\r\n+          onClick={() => setShowStartDialog(true)}\r\n+          className=\"flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n+        >\r\n+          <Plus size={18} />\r\n+          Start New Batch\r\n+        </button>\r\n       </div>\r\n \r\n-      <ProductionWorkflowForm />\r\n+      {loading ? (\r\n+        <div className=\"py-12 text-center text-sm text-zinc-500\">Loading batches...</div>\r\n+      ) : (\r\n+        <div className=\"grid gap-6 lg:grid-cols-3\">\r\n+          {/* Phase 1: De-husking */}\r\n+          <Card\r\n+            title=\"Phase 1: De-husking\"\r\n+            description={`${dehuskingBatches.length} batch${dehuskingBatches.length !== 1 ? \"es\" : \"\"}`}\r\n+            actions={<Badge variant=\"info\">Active</Badge>}\r\n+          >\r\n+            <div className=\"space-y-3\">\r\n+              {dehuskingBatches.length === 0 ? (\r\n+                <p className=\"py-8 text-center text-sm text-zinc-500\">No batches in this phase</p>\r\n+              ) : (\r\n+                dehuskingBatches.map((batch) => (\r\n+                  <BatchCard\r\n+                    key={batch.id}\r\n+                    batch={batch}\r\n+                    onClick={() => setSelectedBatch(batch)}\r\n+                  />\r\n+                ))\r\n+              )}\r\n+            </div>\r\n+          </Card>\r\n \r\n-      <Card title=\"Upcoming Batches\" description=\"Align labor and procurement for the next 48 hours.\">\r\n-        <ul className=\"space-y-3 text-sm text-zinc-600 dark:text-zinc-300\">\r\n-          {upcoming.map((batch) => (\r\n-            <li key={batch.id} className=\"flex items-center justify-between\">\r\n-              <div>\r\n-                <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">{batch.id.toUpperCase()}</p>\r\n-                <p className=\"text-xs text-zinc-500\">\r\n-                  {batch.phase === \"pressing\" ? \"Pressing\" : \"De-husking\"} · Farmer: {batch.farmerName}\r\n-                </p>\r\n-              </div>\r\n-              <span className=\"text-xs text-zinc-500\">{new Date(batch.date).toLocaleString()}</span>\r\n-            </li>\r\n-          ))}\r\n-        </ul>\r\n-      </Card>\r\n+          {/* Phase 2: Pressing */}\r\n+          <Card\r\n+            title=\"Phase 2: Pressing\"\r\n+            description={`${pressingBatches.length} batch${pressingBatches.length !== 1 ? \"es\" : \"\"}`}\r\n+            actions={<Badge variant=\"warning\">Active</Badge>}\r\n+          >\r\n+            <div className=\"space-y-3\">\r\n+              {pressingBatches.length === 0 ? (\r\n+                <p className=\"py-8 text-center text-sm text-zinc-500\">No batches in this phase</p>\r\n+              ) : (\r\n+                pressingBatches.map((batch) => (\r\n+                  <BatchCard\r\n+                    key={batch.id}\r\n+                    batch={batch}\r\n+                    onClick={() => setSelectedBatch(batch)}\r\n+                  />\r\n+                ))\r\n+              )}\r\n+            </div>\r\n+          </Card>\r\n+\r\n+          {/* Phase 3: Bottling */}\r\n+          <Card\r\n+            title=\"Phase 3: Bottling\"\r\n+            description={`${bottlingBatches.length} batch${bottlingBatches.length !== 1 ? \"es\" : \"\"}`}\r\n+            actions={<Badge variant=\"success\">Active</Badge>}\r\n+          >\r\n+            <div className=\"space-y-3\">\r\n+              {bottlingBatches.length === 0 ? (\r\n+                <p className=\"py-8 text-center text-sm text-zinc-500\">No batches in this phase</p>\r\n+              ) : (\r\n+                bottlingBatches.map((batch) => (\r\n+                  <BatchCard\r\n+                    key={batch.id}\r\n+                    batch={batch}\r\n+                    onClick={() => setSelectedBatch(batch)}\r\n+                  />\r\n+                ))\r\n+              )}\r\n+            </div>\r\n+          </Card>\r\n+        </div>\r\n+      )}\r\n+\r\n+      {/* Start Batch Dialog */}\r\n+      {showStartDialog && (\r\n+        <StartBatchDialog\r\n+          onClose={() => setShowStartDialog(false)}\r\n+          onSuccess={() => {\r\n+            setShowStartDialog(false);\r\n+            fetchBatches();\r\n+          }}\r\n+        />\r\n+      )}\r\n+\r\n+      {/* Workflow Form Modal */}\r\n+      {selectedBatch && (\r\n+        <ProductionWorkflowForm\r\n+          batch={selectedBatch}\r\n+          onClose={() => setSelectedBatch(null)}\r\n+          onSuccess={() => {\r\n+            setSelectedBatch(null);\r\n+            fetchBatches();\r\n+          }}\r\n+        />\r\n+      )}\r\n     </div>\r\n   );\r\n }\r\n+\r\n+function BatchCard({\r\n+  batch,\r\n+  onClick,\r\n+}: {\r\n+  batch: ProductionBatch;\r\n+  onClick: () => void;\r\n+}) {\r\n+  return (\r\n+    <button\r\n+      onClick={onClick}\r\n+      className=\"w-full rounded-lg border border-zinc-200 bg-white p-4 text-left shadow-sm transition hover:border-emerald-300 hover:shadow-md dark:border-zinc-800 dark:bg-zinc-900 dark:hover:border-emerald-700\"\r\n+    >\r\n+      <div className=\"flex items-start justify-between\">\r\n+        <div className=\"flex-1\">\r\n+          <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+            {batch.batch_code.toUpperCase()}\r\n+          </p>\r\n+          {batch.farmer_name && (\r\n+            <p className=\"mt-1 text-xs text-zinc-500\">Farmer: {batch.farmer_name}</p>\r\n+          )}\r\n+          <p className=\"mt-1 text-xs text-zinc-500\">\r\n+            {new Date(batch.batch_date).toLocaleDateString()}\r\n+          </p>\r\n+        </div>\r\n+        <div className=\"ml-2\">\r\n+          <Badge variant=\"neutral\" className=\"text-xs\">\r\n+            {getPhaseProgress(batch)}\r\n+          </Badge>\r\n+        </div>\r\n+      </div>\r\n+    </button>\r\n+  );\r\n+}\r\n+\r\n+function getPhaseProgress(batch: ProductionBatch): string {\r\n+  switch (batch.phase) {\r\n+    case \"dehusking\":\r\n+      return batch.output_peanuts_kg ? \"Ready\" : \"Pending\";\r\n+    case \"pressing\":\r\n+      return batch.output_oil_liters ? \"Ready\" : \"Pending\";\r\n+    case \"bottling\":\r\n+      return batch.bottled_units ? \"Complete\" : \"Pending\";\r\n+    default:\r\n+      return \"Pending\";\r\n+  }\r\n+}\r\n+\r\n"
                },
                {
                    "date": 1763364745323,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,17 +10,16 @@\n \r\n type ProductionBatch = {\r\n   id: string;\r\n   batch_code: string;\r\n-  phase: \"dehusking\" | \"pressing\" | \"bottling\";\r\n+  phase: \"dehusking\" | \"pressing\" | \"completed\";\r\n   farmer_name: string | null;\r\n   batch_date: string;\r\n   input_groundnuts_kg: number | null;\r\n   output_peanuts_kg: number | null;\r\n   output_oil_liters: number | null;\r\n   output_oilcake_kg: number | null;\r\n   output_husk_kg: number | null;\r\n-  bottled_units: number | null;\r\n   notes: string | null;\r\n };\r\n \r\n export default function ProductionPage() {\r\n@@ -64,9 +63,9 @@\n   }, []);\r\n \r\n   const dehuskingBatches = batches.filter((b) => b.phase === \"dehusking\");\r\n   const pressingBatches = batches.filter((b) => b.phase === \"pressing\");\r\n-  const bottlingBatches = batches.filter((b) => b.phase === \"bottling\");\r\n+  const completedBatches = batches.filter((b) => b.phase === \"completed\");\r\n \r\n   return (\r\n     <div className=\"space-y-6\">\r\n       <div className=\"flex items-center justify-between\">\r\n@@ -132,19 +131,19 @@\n               )}\r\n             </div>\r\n           </Card>\r\n \r\n-          {/* Phase 3: Bottling */}\r\n+          {/* Completed */}\r\n           <Card\r\n-            title=\"Phase 3: Bottling\"\r\n-            description={`${bottlingBatches.length} batch${bottlingBatches.length !== 1 ? \"es\" : \"\"}`}\r\n-            actions={<Badge variant=\"success\">Active</Badge>}\r\n+            title=\"Completed\"\r\n+            description={`${completedBatches.length} batch${completedBatches.length !== 1 ? \"es\" : \"\"}`}\r\n+            actions={<Badge variant=\"success\">Done</Badge>}\r\n           >\r\n             <div className=\"space-y-3\">\r\n-              {bottlingBatches.length === 0 ? (\r\n-                <p className=\"py-8 text-center text-sm text-zinc-500\">No batches in this phase</p>\r\n+              {completedBatches.length === 0 ? (\r\n+                <p className=\"py-8 text-center text-sm text-zinc-500\">No completed batches</p>\r\n               ) : (\r\n-                bottlingBatches.map((batch) => (\r\n+                completedBatches.map((batch) => (\r\n                   <BatchCard\r\n                     key={batch.id}\r\n                     batch={batch}\r\n                     onClick={() => setSelectedBatch(batch)}\r\n@@ -221,10 +220,10 @@\n     case \"dehusking\":\r\n       return batch.output_peanuts_kg ? \"Ready\" : \"Pending\";\r\n     case \"pressing\":\r\n       return batch.output_oil_liters ? \"Ready\" : \"Pending\";\r\n-    case \"bottling\":\r\n-      return batch.bottled_units ? \"Complete\" : \"Pending\";\r\n+    case \"completed\":\r\n+      return \"Complete\";\r\n     default:\r\n       return \"Pending\";\r\n   }\r\n }\r\n"
                },
                {
                    "date": 1765702839818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,9 +67,9 @@\n   const completedBatches = batches.filter((b) => b.phase === \"completed\");\r\n \r\n   return (\r\n     <div className=\"space-y-6\">\r\n-      <div className=\"flex items-center justify-between\">\r\n+      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\r\n         <div>\r\n           <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">\r\n             Production Workflow\r\n           </h2>\r\n@@ -88,9 +88,9 @@\n \r\n       {loading ? (\r\n         <div className=\"py-12 text-center text-sm text-zinc-500\">Loading batches...</div>\r\n       ) : (\r\n-        <div className=\"grid gap-6 lg:grid-cols-3\">\r\n+        <div className=\"grid grid-cols-1 gap-6 lg:grid-cols-3\">\r\n           {/* Phase 1: De-husking */}\r\n           <Card\r\n             title=\"Phase 1: De-husking\"\r\n             description={`${dehuskingBatches.length} batch${dehuskingBatches.length !== 1 ? \"es\" : \"\"}`}\r\n"
                }
            ],
            "date": 1763069565217,
            "name": "Commit-0",
            "content": "import { Card } from \"@/components/ui/card\";\r\nimport { ProductionWorkflowForm } from \"@/components/production/workflow-form\";\r\nimport { productionBatches } from \"@/lib/sample-data\";\r\n\r\nexport default function ProductionPage() {\r\n  const upcoming = productionBatches.filter((batch) => batch.phase !== \"bottling\");\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">Production Run Planner</h2>\r\n        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n          Log each stage to keep inventory, costing, and compliance aligned.\r\n        </p>\r\n      </div>\r\n\r\n      <ProductionWorkflowForm />\r\n\r\n      <Card title=\"Upcoming Batches\" description=\"Align labor and procurement for the next 48 hours.\">\r\n        <ul className=\"space-y-3 text-sm text-zinc-600 dark:text-zinc-300\">\r\n          {upcoming.map((batch) => (\r\n            <li key={batch.id} className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">{batch.id.toUpperCase()}</p>\r\n                <p className=\"text-xs text-zinc-500\">\r\n                  {batch.phase === \"pressing\" ? \"Pressing\" : \"De-husking\"} · Farmer: {batch.farmerName}\r\n                </p>\r\n              </div>\r\n              <span className=\"text-xs text-zinc-500\">{new Date(batch.date).toLocaleString()}</span>\r\n            </li>\r\n          ))}\r\n        </ul>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}