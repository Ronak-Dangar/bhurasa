{
    "sourceFile": "app/inventory/log/page.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763368599981,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763368599981,
            "name": "Commit-0",
            "content": "import { createSupabaseServerClient } from \"@/lib/supabase/server\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ArrowUp, ArrowDown } from \"lucide-react\";\r\n\r\ntype StockMovement = {\r\n  id: string;\r\n  item_id: string;\r\n  quantity_change: number;\r\n  reason: string | null;\r\n  created_at: string;\r\n  inventory_items: {\r\n    item_name: string;\r\n    unit: string;\r\n  } | null;\r\n};\r\n\r\nexport default async function StockMovementsLogPage() {\r\n  const supabase = await createSupabaseServerClient();\r\n\r\n  const { data: movements, error } = await supabase\r\n    .from(\"stock_movements\")\r\n    .select(`\r\n      id,\r\n      item_id,\r\n      quantity_change,\r\n      reason,\r\n      created_at,\r\n      inventory_items!inner (\r\n        item_name,\r\n        unit\r\n      )\r\n    `)\r\n    .order(\"created_at\", { ascending: false })\r\n    .limit(200);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-6\">\r\n        <p className=\"text-rose-600\">Error loading stock movements: {error.message}</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Transform the data to have the correct shape\r\n  const transformedMovements = (movements || []).map((m: any) => ({\r\n    ...m,\r\n    inventory_items: Array.isArray(m.inventory_items) ? m.inventory_items[0] : m.inventory_items,\r\n  }));\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">\r\n            Stock Movements Log\r\n          </h2>\r\n          <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n            Complete audit trail of all inventory changes\r\n          </p>\r\n        </div>\r\n        <Badge variant=\"info\">\r\n          {movements?.length || 0} {movements?.length === 1 ? \"record\" : \"records\"}\r\n        </Badge>\r\n      </div>\r\n\r\n      <Card title=\"Inventory Ledger\">\r\n        {!transformedMovements || transformedMovements.length === 0 ? (\r\n          <p className=\"py-12 text-center text-sm text-zinc-500\">\r\n            No stock movements recorded yet\r\n          </p>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"border-b border-zinc-200 dark:border-zinc-800\">\r\n                  <th className=\"pb-3 text-left font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                    Date & Time\r\n                  </th>\r\n                  <th className=\"pb-3 text-left font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                    Item\r\n                  </th>\r\n                  <th className=\"pb-3 text-right font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                    Change\r\n                  </th>\r\n                  <th className=\"pb-3 text-left font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                    Reason\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {transformedMovements.map((movement: StockMovement) => {\r\n                  const isIncrease = movement.quantity_change > 0;\r\n                  const date = new Date(movement.created_at);\r\n                  const formattedDate = date.toLocaleDateString(\"en-US\", {\r\n                    month: \"short\",\r\n                    day: \"numeric\",\r\n                    year: \"numeric\",\r\n                  });\r\n                  const formattedTime = date.toLocaleTimeString(\"en-US\", {\r\n                    hour: \"2-digit\",\r\n                    minute: \"2-digit\",\r\n                  });\r\n\r\n                  return (\r\n                    <tr\r\n                      key={movement.id}\r\n                      className=\"border-b border-zinc-100 last:border-0 dark:border-zinc-800/50\"\r\n                    >\r\n                      <td className=\"py-3 text-zinc-700 dark:text-zinc-300\">\r\n                        <div className=\"flex flex-col\">\r\n                          <span className=\"font-medium\">{formattedDate}</span>\r\n                          <span className=\"text-xs text-zinc-500 dark:text-zinc-400\">\r\n                            {formattedTime}\r\n                          </span>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"py-3 font-medium text-zinc-900 dark:text-zinc-100\">\r\n                        {movement.inventory_items?.item_name || \"Unknown Item\"}\r\n                      </td>\r\n                      <td className=\"py-3 text-right\">\r\n                        <div\r\n                          className={`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-semibold ${\r\n                            isIncrease\r\n                              ? \"bg-emerald-100 text-emerald-700 dark:bg-emerald-950/40 dark:text-emerald-400\"\r\n                              : \"bg-rose-100 text-rose-700 dark:bg-rose-950/40 dark:text-rose-400\"\r\n                          }`}\r\n                        >\r\n                          {isIncrease ? (\r\n                            <ArrowUp size={12} />\r\n                          ) : (\r\n                            <ArrowDown size={12} />\r\n                          )}\r\n                          {isIncrease ? \"+\" : \"\"}\r\n                          {movement.quantity_change} {movement.inventory_items?.unit || \"\"}\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"py-3 text-zinc-600 dark:text-zinc-400\">\r\n                        {movement.reason || (\r\n                          <span className=\"italic text-zinc-400 dark:text-zinc-500\">\r\n                            No reason provided\r\n                          </span>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </Card>\r\n\r\n      <div className=\"rounded-lg border border-blue-200 bg-blue-50/70 p-4 text-sm dark:border-blue-900/40 dark:bg-blue-950/30\">\r\n        <p className=\"font-medium text-blue-800 dark:text-blue-200\">\r\n          ðŸ’¡ Audit Trail Information\r\n        </p>\r\n        <p className=\"mt-1 text-blue-700 dark:text-blue-300\">\r\n          This ledger shows the last 200 stock movements. Each entry represents a transaction\r\n          that modified inventory levels. All changes are automatically logged with timestamps\r\n          and reasons for complete traceability.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}