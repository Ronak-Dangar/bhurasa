{
    "sourceFile": "components/customers/customer-details-modal.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763302822980,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763302822980,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { updateCustomer, getCustomerStatusHistory } from \"@/app/actions/customers\";\r\nimport type { Customer, LeadStatus, FamilySize } from \"@/types\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\ninterface CustomerDetailsModalProps {\r\n  customer: Customer;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst LEAD_STATUSES: LeadStatus[] = [\r\n  \"inquiry\",\r\n  \"education\",\r\n  \"price_sent\",\r\n  \"trust_process\",\r\n  \"closed_won\",\r\n  \"feedback_pending\",\r\n  \"refill_due\",\r\n];\r\n\r\nexport function CustomerDetailsModal({ customer, onClose, onSuccess }: CustomerDetailsModalProps) {\r\n  const [activeTab, setActiveTab] = useState<\"details\" | \"timeline\">(\"details\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [statusHistory, setStatusHistory] = useState<any[]>([]);\r\n  const [loadingHistory, setLoadingHistory] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (activeTab === \"timeline\") {\r\n      loadStatusHistory();\r\n    }\r\n  }, [activeTab]);\r\n\r\n  const loadStatusHistory = async () => {\r\n    setLoadingHistory(true);\r\n    const result = await getCustomerStatusHistory(customer.id);\r\n    if (result.success) {\r\n      setStatusHistory(result.data);\r\n    }\r\n    setLoadingHistory(false);\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    const formData = new FormData(e.currentTarget);\r\n    const result = await updateCustomer(customer.id, formData);\r\n\r\n    if (result.success) {\r\n      onSuccess();\r\n    } else {\r\n      setError(result.error || \"Failed to update customer\");\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const formatStatus = (status: string) => {\r\n    return status\r\n      .split(\"_\")\r\n      .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\r\n      .join(\" \");\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n      <div className=\"w-full max-w-2xl rounded-lg bg-white shadow-xl dark:bg-zinc-900\">\r\n        {/* Header */}\r\n        <div className=\"border-b border-zinc-200 px-6 py-4 dark:border-zinc-800\">\r\n          <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n            Customer 360: {customer.name}\r\n          </h3>\r\n          <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n            {customer.phone}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Tabs */}\r\n        <div className=\"flex border-b border-zinc-200 dark:border-zinc-800\">\r\n          <button\r\n            onClick={() => setActiveTab(\"details\")}\r\n            className={`px-6 py-3 text-sm font-medium transition-colors ${\r\n              activeTab === \"details\"\r\n                ? \"border-b-2 border-emerald-600 text-emerald-600\"\r\n                : \"text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100\"\r\n            }`}\r\n          >\r\n            Details\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab(\"timeline\")}\r\n            className={`px-6 py-3 text-sm font-medium transition-colors ${\r\n              activeTab === \"timeline\"\r\n                ? \"border-b-2 border-emerald-600 text-emerald-600\"\r\n                : \"text-zinc-600 hover:text-zinc-900 dark:text-zinc-400 dark:hover:text-zinc-100\"\r\n            }`}\r\n          >\r\n            Activity Timeline\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"max-h-[calc(100vh-300px)] overflow-y-auto p-6\">\r\n          {activeTab === \"details\" ? (\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              {error && (\r\n                <div className=\"rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n                  {error}\r\n                </div>\r\n              )}\r\n\r\n              <div>\r\n                <label htmlFor=\"edit-name\" className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                  Name *\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"edit-name\"\r\n                  name=\"name\"\r\n                  required\r\n                  defaultValue={customer.name}\r\n                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"edit-phone\" className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                  Phone *\r\n                </label>\r\n                <input\r\n                  type=\"tel\"\r\n                  id=\"edit-phone\"\r\n                  name=\"phone\"\r\n                  required\r\n                  defaultValue={customer.phone}\r\n                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"edit-address\" className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                  Address *\r\n                </label>\r\n                <textarea\r\n                  id=\"edit-address\"\r\n                  name=\"address\"\r\n                  required\r\n                  rows={3}\r\n                  defaultValue={customer.address}\r\n                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"edit-family_size\" className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                  Family Size *\r\n                </label>\r\n                <select\r\n                  id=\"edit-family_size\"\r\n                  name=\"family_size\"\r\n                  required\r\n                  defaultValue={customer.familySize}\r\n                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n                >\r\n                  <option value=\"small\">Small (1L/month)</option>\r\n                  <option value=\"medium\">Medium (2L/month)</option>\r\n                  <option value=\"large\">Large (3L/month)</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"edit-status\" className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                  Status (Manual Override)\r\n                </label>\r\n                <p className=\"mt-1 text-xs text-zinc-500 dark:text-zinc-400\">\r\n                  Manually move customer through the nurture funnel\r\n                </p>\r\n                <select\r\n                  id=\"edit-status\"\r\n                  name=\"status\"\r\n                  defaultValue={customer.status}\r\n                  className=\"mt-2 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n                >\r\n                  {LEAD_STATUSES.map((status) => (\r\n                    <option key={status} value={status}>\r\n                      {formatStatus(status)}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"flex justify-end gap-3 pt-4\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={onClose}\r\n                  disabled={loading}\r\n                  className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={loading}\r\n                  className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n                >\r\n                  {loading ? \"Saving...\" : \"Save Changes\"}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          ) : (\r\n            <div className=\"space-y-4\">\r\n              {loadingHistory ? (\r\n                <div className=\"py-8 text-center text-sm text-zinc-500\">Loading history...</div>\r\n              ) : statusHistory.length === 0 ? (\r\n                <div className=\"py-8 text-center text-sm text-zinc-500\">No activity recorded yet.</div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {statusHistory.map((entry) => (\r\n                    <div\r\n                      key={entry.id}\r\n                      className=\"rounded-lg border border-zinc-200 bg-white p-4 dark:border-zinc-800 dark:bg-zinc-900\"\r\n                    >\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex-1\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"info\">{formatStatus(entry.status)}</Badge>\r\n                            <span className=\"text-xs text-zinc-500\">\r\n                              {new Date(entry.changed_at).toLocaleString()}\r\n                            </span>\r\n                          </div>\r\n                          {entry.notes && (\r\n                            <p className=\"mt-2 text-sm text-zinc-700 dark:text-zinc-300\">\r\n                              {entry.notes}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer for Timeline tab */}\r\n        {activeTab === \"timeline\" && (\r\n          <div className=\"border-t border-zinc-200 px-6 py-4 dark:border-zinc-800\">\r\n            <button\r\n              onClick={onClose}\r\n              className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}