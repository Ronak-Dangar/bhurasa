{
    "sourceFile": "components/orders/create-order-form.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1763069565217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763302823085,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,15 @@\n \"use client\";\r\n \r\n-import { useMemo, useState } from \"react\";\r\n+import { useMemo, useState, useEffect } from \"react\";\r\n import { useForm, useFieldArray, useWatch } from \"react-hook-form\";\r\n import { zodResolver } from \"@hookform/resolvers/zod\";\r\n import { z } from \"zod\";\r\n import { Card } from \"@/components/ui/card\";\r\n import { Badge } from \"@/components/ui/badge\";\r\n-import { customers, deliveryAgents, productCatalog } from \"@/lib/sample-data\";\r\n+import { createOrder, getAllCustomersForDropdown, getAllInventoryItems, getDeliveryAgents } from \"@/app/actions/orders\";\r\n+import { AddCustomerDialog } from \"@/components/customers/add-customer-dialog\";\r\n+import { PlusCircle } from \"lucide-react\";\r\n \r\n const orderSchema = z.object({\r\n   customerId: z.string().min(1, \"Select a customer\"),\r\n   paymentStatus: z.enum([\"cod\", \"prepaid\"]),\r\n@@ -26,18 +28,44 @@\n export type OrderFormValues = z.infer<typeof orderSchema>;\r\n \r\n export function CreateOrderForm() {\r\n   const [submitted, setSubmitted] = useState<OrderFormValues | null>(null);\r\n+  const [customers, setCustomers] = useState<any[]>([]);\r\n+  const [products, setProducts] = useState<any[]>([]);\r\n+  const [deliveryAgents, setDeliveryAgents] = useState<any[]>([]);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [showAddCustomer, setShowAddCustomer] = useState(false);\r\n+  const [submitting, setSubmitting] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+  const [searchTerm, setSearchTerm] = useState(\"\");\r\n \r\n+  useEffect(() => {\r\n+    loadData();\r\n+  }, []);\r\n+\r\n+  const loadData = async () => {\r\n+    setLoading(true);\r\n+    const [customersResult, productsResult, agentsResult] = await Promise.all([\r\n+      getAllCustomersForDropdown(),\r\n+      getAllInventoryItems(),\r\n+      getDeliveryAgents(),\r\n+    ]);\r\n+\r\n+    if (customersResult.success) setCustomers(customersResult.data);\r\n+    if (productsResult.success) setProducts(productsResult.data);\r\n+    if (agentsResult.success) setDeliveryAgents(agentsResult.data);\r\n+    setLoading(false);\r\n+  };\r\n+\r\n   const form = useForm<OrderFormValues>({\r\n     resolver: zodResolver(orderSchema),\r\n     defaultValues: {\r\n       customerId: \"\",\r\n       paymentStatus: \"prepaid\",\r\n-      deliveryAgentId: deliveryAgents[0]?.id,\r\n+      deliveryAgentId: \"\",\r\n       items: [\r\n         {\r\n-          productId: productCatalog[0]?.id ?? \"\",\r\n+          productId: \"\",\r\n           quantity: 1,\r\n         },\r\n       ],\r\n     },\r\n@@ -47,23 +75,63 @@\n \r\n   const customerId = useWatch({ control: form.control, name: \"customerId\" }) ?? \"\";\r\n   const selectedCustomer = useMemo(\r\n     () => customers.find((customer) => customer.id === customerId),\r\n-    [customerId],\r\n+    [customerId, customers],\r\n   );\r\n \r\n   const watchedItems = useWatch({ control: form.control, name: \"items\" }) as OrderFormValues[\"items\"] | undefined;\r\n   const items = watchedItems ?? form.getValues(\"items\");\r\n+  \r\n   const totalAmount = useMemo(() => {\r\n     return items.reduce((acc, item) => {\r\n-      const product = productCatalog.find((product) => product.id === item.productId);\r\n+      const product = products.find((product) => product.id === item.productId);\r\n       if (!product) return acc;\r\n-      return acc + product.unitPrice * item.quantity;\r\n+      return acc + product.avg_cost * item.quantity;\r\n     }, 0);\r\n-  }, [items]);\r\n+  }, [items, products]);\r\n \r\n-  const handleSubmit = form.handleSubmit((values) => {\r\n-    setSubmitted(values);\r\n+  const filteredCustomers = useMemo(() => {\r\n+    if (!searchTerm) return customers;\r\n+    const search = searchTerm.toLowerCase();\r\n+    return customers.filter(\r\n+      (c) =>\r\n+        c.name.toLowerCase().includes(search) ||\r\n+        c.phone.toLowerCase().includes(search)\r\n+    );\r\n+  }, [customers, searchTerm]);\r\n+\r\n+  const handleSubmit = form.handleSubmit(async (values) => {\r\n+    setSubmitting(true);\r\n+    setError(null);\r\n+\r\n+    // Build order data with product details\r\n+    const orderData = {\r\n+      customerId: values.customerId,\r\n+      paymentStatus: values.paymentStatus,\r\n+      deliveryAgentId: values.deliveryAgentId || undefined,\r\n+      items: values.items.map((item) => {\r\n+        const product = products.find((p) => p.id === item.productId);\r\n+        return {\r\n+          productId: item.productId,\r\n+          productName: product?.item_name || \"Unknown Product\",\r\n+          quantity: item.quantity,\r\n+          unitPrice: product?.avg_cost || 0,\r\n+        };\r\n+      }),\r\n+    };\r\n+\r\n+    const result = await createOrder(orderData);\r\n+\r\n+    if (result.success) {\r\n+      setSubmitted(values);\r\n+      form.reset();\r\n+      // Reload data to refresh inventory\r\n+      loadData();\r\n+    } else {\r\n+      setError(result.error || \"Failed to create order\");\r\n+    }\r\n+    setSubmitting(false);\r\n   });\r\n \r\n   return (\r\n     <div className=\"grid gap-6 lg:grid-cols-[3fr_2fr]\">\r\n@@ -71,177 +139,223 @@\n         title=\"Raise New Order\"\r\n         description=\"Capture customer request and reserve inventory.\"\r\n         actions={<Badge variant=\"info\">Draft</Badge>}\r\n       >\r\n-        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n-          <section className=\"space-y-4\">\r\n-            <div>\r\n-              <label htmlFor=\"customerId\" className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n-                Customer\r\n-              </label>\r\n-              <select\r\n-                id=\"customerId\"\r\n-                {...form.register(\"customerId\")}\r\n-                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-              >\r\n-                <option value=\"\">Select customer</option>\r\n-                {customers.map((customer) => (\r\n-                  <option key={customer.id} value={customer.id}>\r\n-                    {customer.name} · {customer.phone}\r\n-                  </option>\r\n-                ))}\r\n-              </select>\r\n-              {form.formState.errors.customerId && (\r\n-                <p className=\"mt-1 text-xs text-rose-500\">{form.formState.errors.customerId.message}</p>\r\n-              )}\r\n-            </div>\r\n-\r\n-            {selectedCustomer && (\r\n-              <div className=\"rounded-lg border border-emerald-200/60 bg-emerald-50/60 p-4 text-sm dark:border-emerald-900/40 dark:bg-emerald-950/20\">\r\n-                <p className=\"font-semibold text-emerald-800 dark:text-emerald-200\">Delivery Address</p>\r\n-                <p className=\"mt-1 text-emerald-700 dark:text-emerald-200/80\">{selectedCustomer.address}</p>\r\n-                <p className=\"mt-1 text-xs text-emerald-600/80 dark:text-emerald-200/60\">\r\n-                  Family size: {selectedCustomer.familySize.toUpperCase()} · Status: {formatStatus(selectedCustomer.status)}\r\n-                </p>\r\n+        {loading ? (\r\n+          <div className=\"py-8 text-center text-sm text-zinc-500\">Loading form data...</div>\r\n+        ) : (\r\n+          <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n+            {error && (\r\n+              <div className=\"rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n+                {error}\r\n               </div>\r\n             )}\r\n-          </section>\r\n \r\n-          <section className=\"space-y-4\">\r\n-            <header className=\"flex items-center justify-between\">\r\n-              <h3 className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">Products</h3>\r\n-              <button\r\n-                type=\"button\"\r\n-                className=\"text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n-                onClick={() =>\r\n-                  append({\r\n-                    productId: productCatalog[0]?.id ?? \"\",\r\n-                    quantity: 1,\r\n-                  })\r\n-                }\r\n-              >\r\n-                + Add product\r\n-              </button>\r\n-            </header>\r\n+            <section className=\"space-y-4\">\r\n+              <div>\r\n+                <div className=\"flex items-center justify-between\">\r\n+                  <label htmlFor=\"customerId\" className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                    Customer\r\n+                  </label>\r\n+                  <button\r\n+                    type=\"button\"\r\n+                    onClick={() => setShowAddCustomer(true)}\r\n+                    className=\"flex items-center gap-1 text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  >\r\n+                    <PlusCircle size={16} />\r\n+                    Add New\r\n+                  </button>\r\n+                </div>\r\n+                <input\r\n+                  type=\"text\"\r\n+                  placeholder=\"Search by name or phone...\"\r\n+                  value={searchTerm}\r\n+                  onChange={(e) => setSearchTerm(e.target.value)}\r\n+                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                />\r\n+                <select\r\n+                  id=\"customerId\"\r\n+                  {...form.register(\"customerId\")}\r\n+                  className=\"mt-2 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"\">Select customer</option>\r\n+                  {filteredCustomers.map((customer) => (\r\n+                    <option key={customer.id} value={customer.id}>\r\n+                      {customer.name} · {customer.phone}\r\n+                    </option>\r\n+                  ))}\r\n+                </select>\r\n+                {form.formState.errors.customerId && (\r\n+                  <p className=\"mt-1 text-xs text-rose-500\">{form.formState.errors.customerId.message}</p>\r\n+                )}\r\n+              </div>\r\n \r\n-            <div className=\"space-y-3\">\r\n-              {fields.map((field, index) => {\r\n-                  const currentItem = items[index];\r\n-                  const price = productCatalog.find((product) => product.id === currentItem?.productId)?.unitPrice ?? 0;\r\n-                  const quantity = currentItem?.quantity ?? 0;\r\n-                return (\r\n-                  <div\r\n-                    key={field.id}\r\n-                    className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_auto]\"\r\n-                  >\r\n-                    <div>\r\n-                      <label className=\"text-xs font-medium uppercase text-zinc-500\">Product</label>\r\n-                      <select\r\n-                        {...form.register(`items.${index}.productId` as const)}\r\n-                        className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-                      >\r\n-                        {productCatalog.map((product) => (\r\n-                          <option key={product.id} value={product.id}>\r\n-                            {product.name} · ₹{product.unitPrice}\r\n-                          </option>\r\n-                        ))}\r\n-                      </select>\r\n+              {selectedCustomer && (\r\n+                <div className=\"rounded-lg border border-emerald-200/60 bg-emerald-50/60 p-4 text-sm dark:border-emerald-900/40 dark:bg-emerald-950/20\">\r\n+                  <p className=\"font-semibold text-emerald-800 dark:text-emerald-200\">Delivery Address</p>\r\n+                  <p className=\"mt-1 text-emerald-700 dark:text-emerald-200/80\">{selectedCustomer.address}</p>\r\n+                  <p className=\"mt-1 text-xs text-emerald-600/80 dark:text-emerald-200/60\">\r\n+                    Family size: {selectedCustomer.family_size?.toUpperCase()} · Status: {formatStatus(selectedCustomer.status)}\r\n+                  </p>\r\n+                </div>\r\n+              )}\r\n+            </section>\r\n+\r\n+            <section className=\"space-y-4\">\r\n+              <header className=\"flex items-center justify-between\">\r\n+                <h3 className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">Products</h3>\r\n+                <button\r\n+                  type=\"button\"\r\n+                  className=\"text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  onClick={() =>\r\n+                    append({\r\n+                      productId: products[0]?.id ?? \"\",\r\n+                      quantity: 1,\r\n+                    })\r\n+                  }\r\n+                >\r\n+                  + Add product\r\n+                </button>\r\n+              </header>\r\n+\r\n+              <div className=\"space-y-3\">\r\n+                {fields.map((field, index) => {\r\n+                    const currentItem = items[index];\r\n+                    const price = products.find((product: any) => product.id === currentItem?.productId)?.avg_cost ?? 0;\r\n+                    const quantity = currentItem?.quantity ?? 0;\r\n+                  return (\r\n+                    <div\r\n+                      key={field.id}\r\n+                      className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_auto]\"\r\n+                    >\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Product</label>\r\n+                        <select\r\n+                          {...form.register(`items.${index}.productId` as const)}\r\n+                          className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                        >\r\n+                          {products.map((product: any) => (\r\n+                            <option key={product.id} value={product.id}>\r\n+                              {product.item_name} · ₹{product.avg_cost}\r\n+                            </option>\r\n+                          ))}\r\n+                        </select>\r\n+                      </div>\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Quantity</label>\r\n+                        <input\r\n+                          type=\"number\"\r\n+                          min={1}\r\n+                          {...form.register(`items.${index}.quantity` as const, { valueAsNumber: true })}\r\n+                          className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                        />\r\n+                      </div>\r\n+                      <div className=\"flex flex-col items-end justify-between text-xs text-zinc-500\">\r\n+                        <span>Line Total</span>\r\n+                          <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                            ₹{(price * quantity).toLocaleString(\"en-IN\")}\r\n+                        </span>\r\n+                        {fields.length > 1 && (\r\n+                          <button type=\"button\" onClick={() => remove(index)} className=\"text-xs text-rose-500\">\r\n+                            Remove\r\n+                          </button>\r\n+                        )}\r\n+                      </div>\r\n                     </div>\r\n-                    <div>\r\n-                      <label className=\"text-xs font-medium uppercase text-zinc-500\">Quantity</label>\r\n-                      <input\r\n-                        type=\"number\"\r\n-                        min={1}\r\n-                        {...form.register(`items.${index}.quantity` as const, { valueAsNumber: true })}\r\n-                        className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-                      />\r\n-                    </div>\r\n-                    <div className=\"flex flex-col items-end justify-between text-xs text-zinc-500\">\r\n-                      <span>Line Total</span>\r\n-                        <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n-                          ₹{(price * quantity).toLocaleString(\"en-IN\")}\r\n-                      </span>\r\n-                      {fields.length > 1 && (\r\n-                        <button type=\"button\" onClick={() => remove(index)} className=\"text-xs text-rose-500\">\r\n-                          Remove\r\n-                        </button>\r\n-                      )}\r\n-                    </div>\r\n-                  </div>\r\n-                );\r\n-              })}\r\n-            </div>\r\n+                  );\r\n+                })}\r\n+              </div>\r\n \r\n-            {form.formState.errors.items && (\r\n-              <p className=\"text-xs text-rose-500\">{form.formState.errors.items.message as string}</p>\r\n-            )}\r\n-          </section>\r\n+              {form.formState.errors.items && (\r\n+                <p className=\"text-xs text-rose-500\">{form.formState.errors.items.message as string}</p>\r\n+              )}\r\n+            </section>\r\n \r\n-          <section className=\"grid gap-4 md:grid-cols-2\">\r\n+            <section className=\"grid gap-4 md:grid-cols-2\">\r\n+              <div>\r\n+                <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Payment Status</label>\r\n+                <select\r\n+                  {...form.register(\"paymentStatus\")}\r\n+                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"prepaid\">Prepaid</option>\r\n+                  <option value=\"cod\">Cash on Delivery</option>\r\n+                </select>\r\n+              </div>\r\n+              <div>\r\n+                <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n+                <select\r\n+                  {...form.register(\"deliveryAgentId\")}\r\n+                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"\">Unassigned</option>\r\n+                  {deliveryAgents.map((agent: any) => (\r\n+                    <option key={agent.id} value={agent.id}>\r\n+                      {agent.full_name}\r\n+                    </option>\r\n+                  ))}\r\n+                </select>\r\n+              </div>\r\n+            </section>\r\n+\r\n             <div>\r\n-              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Payment Status</label>\r\n-              <select\r\n-                {...form.register(\"paymentStatus\")}\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Internal Notes</label>\r\n+              <textarea\r\n+                {...form.register(\"notes\")}\r\n+                rows={3}\r\n                 className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-              >\r\n-                <option value=\"prepaid\">Prepaid</option>\r\n-                <option value=\"cod\">Cash on Delivery</option>\r\n-              </select>\r\n+                placeholder=\"Delivery preference, packaging instructions, etc.\"\r\n+              />\r\n             </div>\r\n-            <div>\r\n-              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n-              <select\r\n-                {...form.register(\"deliveryAgentId\")}\r\n-                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+\r\n+            <div className=\"flex items-center justify-between border-t border-zinc-200 pt-4 text-sm dark:border-zinc-800\">\r\n+              <div className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n+                Total\r\n+                <span className=\"ml-2 text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                  ₹{totalAmount.toLocaleString(\"en-IN\")}\r\n+                </span>\r\n+              </div>\r\n+              <button\r\n+                type=\"submit\"\r\n+                disabled={submitting}\r\n+                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n               >\r\n-                <option value=\"\">Unassigned</option>\r\n-                {deliveryAgents.map((agent) => (\r\n-                  <option key={agent.id} value={agent.id}>\r\n-                    {agent.name}\r\n-                  </option>\r\n-                ))}\r\n-              </select>\r\n+                {submitting ? \"Creating Order...\" : \"Raise Order\"}\r\n+              </button>\r\n             </div>\r\n-          </section>\r\n-\r\n-          <div>\r\n-            <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Internal Notes</label>\r\n-            <textarea\r\n-              {...form.register(\"notes\")}\r\n-              rows={3}\r\n-              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-              placeholder=\"Delivery preference, packaging instructions, etc.\"\r\n-            />\r\n-          </div>\r\n-\r\n-          <div className=\"flex items-center justify-between border-t border-zinc-200 pt-4 text-sm dark:border-zinc-800\">\r\n-            <div className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n-              Total\r\n-              <span className=\"ml-2 text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n-                ₹{totalAmount.toLocaleString(\"en-IN\")}\r\n-              </span>\r\n-            </div>\r\n-            <button\r\n-              type=\"submit\"\r\n-              className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n-            >\r\n-              Raise Order\r\n-            </button>\r\n-          </div>\r\n-        </form>\r\n+          </form>\r\n+        )}\r\n       </Card>\r\n \r\n       <Card title=\"Preview\" description=\"This is what will be synced to Supabase.\">\r\n         {submitted ? (\r\n-          <pre className=\"max-h-[460px] overflow-auto rounded-lg bg-zinc-900 p-4 text-xs text-emerald-200\">\r\n+          <div className=\"space-y-3\">\r\n+            <div className=\"rounded-lg bg-emerald-50 p-3 dark:bg-emerald-900/20\">\r\n+              <p className=\"text-sm font-semibold text-emerald-800 dark:text-emerald-200\">\r\n+                ✓ Order created successfully!\r\n+              </p>\r\n+            </div>\r\n+            <pre className=\"max-h-[460px] overflow-auto rounded-lg bg-zinc-900 p-4 text-xs text-emerald-200\">\r\n {JSON.stringify(submitted, null, 2)}\r\n-          </pre>\r\n+            </pre>\r\n+          </div>\r\n         ) : (\r\n           <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n             Fill the order form to preview payload details before pushing to the database.\r\n           </p>\r\n         )}\r\n       </Card>\r\n+\r\n+      {/* Add Customer Dialog */}\r\n+      {showAddCustomer && (\r\n+        <AddCustomerDialog\r\n+          onClose={() => setShowAddCustomer(false)}\r\n+          onSuccess={() => {\r\n+            setShowAddCustomer(false);\r\n+            loadData();\r\n+          }}\r\n+        />\r\n+      )}\r\n     </div>\r\n   );\r\n }\r\n \r\n"
                },
                {
                    "date": 1765424201602,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,11 +5,11 @@\n import { zodResolver } from \"@hookform/resolvers/zod\";\r\n import { z } from \"zod\";\r\n import { Card } from \"@/components/ui/card\";\r\n import { Badge } from \"@/components/ui/badge\";\r\n-import { createOrder, getAllCustomersForDropdown, getAllInventoryItems, getDeliveryAgents } from \"@/app/actions/orders\";\r\n+import { createOrder, getAllCustomersForDropdown, getAllInventoryItems, getDeliveryAgents, createDeliveryAgent } from \"@/app/actions/orders\";\r\n import { AddCustomerDialog } from \"@/components/customers/add-customer-dialog\";\r\n-import { PlusCircle } from \"lucide-react\";\r\n+import { PlusCircle, UserPlus, AlertCircle } from \"lucide-react\";\r\n \r\n const orderSchema = z.object({\r\n   customerId: z.string().min(1, \"Select a customer\"),\r\n   paymentStatus: z.enum([\"cod\", \"prepaid\"]),\r\n@@ -18,8 +18,9 @@\n     .array(\r\n       z.object({\r\n         productId: z.string().min(1, \"Choose a product\"),\r\n         quantity: z.number().min(1, \"Quantity must be at least 1\"),\r\n+        unitPrice: z.number().min(0, \"Price must be positive\"),\r\n       }),\r\n     )\r\n     .min(1, \"Add at least one product\"),\r\n   notes: z.string().optional(),\r\n@@ -33,11 +34,14 @@\n   const [products, setProducts] = useState<any[]>([]);\r\n   const [deliveryAgents, setDeliveryAgents] = useState<any[]>([]);\r\n   const [loading, setLoading] = useState(true);\r\n   const [showAddCustomer, setShowAddCustomer] = useState(false);\r\n+  const [showAddAgent, setShowAddAgent] = useState(false);\r\n   const [submitting, setSubmitting] = useState(false);\r\n   const [error, setError] = useState<string | null>(null);\r\n-  const [searchTerm, setSearchTerm] = useState(\"\");\r\n+  const [customerSearchTerm, setCustomerSearchTerm] = useState(\"\");\r\n+  const [customerSearchFocused, setCustomerSearchFocused] = useState(false);\r\n+  const [inventoryErrors, setInventoryErrors] = useState<Record<number, string>>({});\r\n \r\n   useEffect(() => {\r\n     loadData();\r\n   }, []);\r\n@@ -63,10 +67,11 @@\n       paymentStatus: \"prepaid\",\r\n       deliveryAgentId: \"\",\r\n       items: [\r\n         {\r\n-          productId: \"\",\r\n+          productId: products[0]?.id || \"\",\r\n           quantity: 1,\r\n+          unitPrice: products[0]?.selling_price || 0,\r\n         },\r\n       ],\r\n     },\r\n   });\r\n@@ -81,26 +86,42 @@\n \r\n   const watchedItems = useWatch({ control: form.control, name: \"items\" }) as OrderFormValues[\"items\"] | undefined;\r\n   const items = watchedItems ?? form.getValues(\"items\");\r\n   \r\n+  // Validate inventory in real-time\r\n+  useEffect(() => {\r\n+    const errors: Record<number, string> = {};\r\n+    items.forEach((item, index) => {\r\n+      const product = products.find((p) => p.id === item.productId);\r\n+      if (product && item.quantity > product.stock_level) {\r\n+        errors[index] = `Cannot exceed available stock (${product.stock_level})`;\r\n+      }\r\n+    });\r\n+    setInventoryErrors(errors);\r\n+  }, [items, products]);\r\n+\r\n+  const hasInventoryErrors = Object.keys(inventoryErrors).length > 0;\r\n+  \r\n   const totalAmount = useMemo(() => {\r\n     return items.reduce((acc, item) => {\r\n-      const product = products.find((product) => product.id === item.productId);\r\n-      if (!product) return acc;\r\n-      return acc + product.avg_cost * item.quantity;\r\n+      // Use the editable unitPrice from the form, not avg_cost\r\n+      const unitPrice = item.unitPrice || 0;\r\n+      return acc + unitPrice * item.quantity;\r\n     }, 0);\r\n-  }, [items, products]);\r\n+  }, [items]);\r\n \r\n   const filteredCustomers = useMemo(() => {\r\n-    if (!searchTerm) return customers;\r\n-    const search = searchTerm.toLowerCase();\r\n+    if (!customerSearchTerm) return customers;\r\n+    const search = customerSearchTerm.toLowerCase();\r\n     return customers.filter(\r\n       (c) =>\r\n         c.name.toLowerCase().includes(search) ||\r\n         c.phone.toLowerCase().includes(search)\r\n     );\r\n-  }, [customers, searchTerm]);\r\n+  }, [customers, customerSearchTerm]);\r\n \r\n+  const showAddNewCustomerButton = customerSearchTerm.length > 0 && filteredCustomers.length === 0;\r\n+\r\n   const handleSubmit = form.handleSubmit(async (values) => {\r\n     setSubmitting(true);\r\n     setError(null);\r\n \r\n@@ -114,9 +135,9 @@\n         return {\r\n           productId: item.productId,\r\n           productName: product?.item_name || \"Unknown Product\",\r\n           quantity: item.quantity,\r\n-          unitPrice: product?.avg_cost || 0,\r\n+          unitPrice: item.unitPrice, // Use the editable price from form\r\n         };\r\n       }),\r\n     };\r\n \r\n@@ -164,27 +185,64 @@\n                     <PlusCircle size={16} />\r\n                     Add New\r\n                   </button>\r\n                 </div>\r\n-                <input\r\n-                  type=\"text\"\r\n-                  placeholder=\"Search by name or phone...\"\r\n-                  value={searchTerm}\r\n-                  onChange={(e) => setSearchTerm(e.target.value)}\r\n-                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-                />\r\n-                <select\r\n-                  id=\"customerId\"\r\n-                  {...form.register(\"customerId\")}\r\n-                  className=\"mt-2 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-                >\r\n-                  <option value=\"\">Select customer</option>\r\n-                  {filteredCustomers.map((customer) => (\r\n-                    <option key={customer.id} value={customer.id}>\r\n-                      {customer.name} · {customer.phone}\r\n-                    </option>\r\n-                  ))}\r\n-                </select>\r\n+                \r\n+                {/* Searchable Customer Combobox */}\r\n+                <div className=\"relative\">\r\n+                  <input\r\n+                    type=\"text\"\r\n+                    placeholder=\"Search by name or phone...\"\r\n+                    value={customerSearchTerm}\r\n+                    onChange={(e) => {\r\n+                      setCustomerSearchTerm(e.target.value);\r\n+                      setCustomerSearchFocused(true);\r\n+                    }}\r\n+                    onFocus={() => setCustomerSearchFocused(true)}\r\n+                    className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                  />\r\n+                  \r\n+                  {/* Dropdown results */}\r\n+                  {customerSearchFocused && (customerSearchTerm.length > 0 || customerId === \"\") && (\r\n+                    <div className=\"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-lg border border-zinc-300 bg-white shadow-lg dark:border-zinc-700 dark:bg-zinc-900\">\r\n+                      {filteredCustomers.length > 0 ? (\r\n+                        filteredCustomers.map((customer) => (\r\n+                          <button\r\n+                            key={customer.id}\r\n+                            type=\"button\"\r\n+                            onClick={() => {\r\n+                              form.setValue(\"customerId\", customer.id);\r\n+                              setCustomerSearchTerm(customer.name);\r\n+                              setCustomerSearchFocused(false);\r\n+                            }}\r\n+                            className=\"w-full px-4 py-2 text-left text-sm hover:bg-emerald-50 dark:hover:bg-emerald-950/30\"\r\n+                          >\r\n+                            <div className=\"font-medium text-zinc-900 dark:text-zinc-100\">{customer.name}</div>\r\n+                            <div className=\"text-xs text-zinc-500 dark:text-zinc-400\">{customer.phone}</div>\r\n+                          </button>\r\n+                        ))\r\n+                      ) : showAddNewCustomerButton ? (\r\n+                        <button\r\n+                          type=\"button\"\r\n+                          onClick={() => {\r\n+                            setShowAddCustomer(true);\r\n+                            setCustomerSearchFocused(false);\r\n+                          }}\r\n+                          className=\"flex w-full items-center gap-2 px-4 py-3 text-left text-sm text-emerald-600 hover:bg-emerald-50 dark:text-emerald-400 dark:hover:bg-emerald-950/30\"\r\n+                        >\r\n+                          <PlusCircle size={16} />\r\n+                          <span>Add new customer &quot;{customerSearchTerm}&quot;</span>\r\n+                        </button>\r\n+                      ) : (\r\n+                        <div className=\"px-4 py-3 text-sm text-zinc-500\">Type to search customers...</div>\r\n+                      )}\r\n+                    </div>\r\n+                  )}\r\n+                </div>\r\n+                \r\n+                {/* Hidden select for form validation */}\r\n+                <input type=\"hidden\" {...form.register(\"customerId\")} />\r\n+                \r\n                 {form.formState.errors.customerId && (\r\n                   <p className=\"mt-1 text-xs text-rose-500\">{form.formState.errors.customerId.message}</p>\r\n                 )}\r\n               </div>\r\n@@ -209,8 +267,9 @@\n                   onClick={() =>\r\n                     append({\r\n                       productId: products[0]?.id ?? \"\",\r\n                       quantity: 1,\r\n+                      unitPrice: products[0]?.selling_price ?? 0,\r\n                     })\r\n                   }\r\n                 >\r\n                   + Add product\r\n@@ -219,41 +278,81 @@\n \r\n               <div className=\"space-y-3\">\r\n                 {fields.map((field, index) => {\r\n                     const currentItem = items[index];\r\n-                    const price = products.find((product: any) => product.id === currentItem?.productId)?.avg_cost ?? 0;\r\n+                    const product = products.find((p: any) => p.id === currentItem?.productId);\r\n+                    const unitPrice = currentItem?.unitPrice ?? 0;\r\n                     const quantity = currentItem?.quantity ?? 0;\r\n+                    const stockLevel = product?.stock_level ?? 0;\r\n+                    const hasError = !!inventoryErrors[index];\r\n                   return (\r\n                     <div\r\n                       key={field.id}\r\n-                      className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_auto]\"\r\n+                      className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_1fr_auto]\"\r\n                     >\r\n                       <div>\r\n                         <label className=\"text-xs font-medium uppercase text-zinc-500\">Product</label>\r\n                         <select\r\n-                          {...form.register(`items.${index}.productId` as const)}\r\n+                          {...form.register(`items.${index}.productId` as const, {\r\n+                            onChange: (e) => {\r\n+                              // Auto-fill unit price when product changes\r\n+                              const selectedProduct = products.find((p: any) => p.id === e.target.value);\r\n+                              if (selectedProduct) {\r\n+                                form.setValue(`items.${index}.unitPrice`, selectedProduct.selling_price || 0);\r\n+                              }\r\n+                            }\r\n+                          })}\r\n                           className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n                         >\r\n                           {products.map((product: any) => (\r\n                             <option key={product.id} value={product.id}>\r\n-                              {product.item_name} · ₹{product.avg_cost}\r\n+                              {product.item_name}\r\n                             </option>\r\n                           ))}\r\n                         </select>\r\n+                        {product && (\r\n+                          <div className=\"mt-1 flex items-center gap-1 text-xs text-zinc-600 dark:text-zinc-400\">\r\n+                            <span className=\"font-medium\">Available:</span>\r\n+                            <Badge variant={stockLevel < 10 ? \"danger\" : \"success\"}>\r\n+                              {stockLevel} {product.unit}\r\n+                            </Badge>\r\n+                          </div>\r\n+                        )}\r\n                       </div>\r\n                       <div>\r\n                         <label className=\"text-xs font-medium uppercase text-zinc-500\">Quantity</label>\r\n                         <input\r\n                           type=\"number\"\r\n                           min={1}\r\n                           {...form.register(`items.${index}.quantity` as const, { valueAsNumber: true })}\r\n+                          className={`mt-1 w-full rounded-lg border px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 dark:bg-zinc-900 dark:text-zinc-100 ${\r\n+                            hasError\r\n+                              ? \"border-rose-500 focus:border-rose-500 focus:ring-rose-200\"\r\n+                              : \"border-zinc-300 focus:border-emerald-500 focus:ring-emerald-200 dark:border-zinc-700\"\r\n+                          }`}\r\n+                        />\r\n+                        {hasError && (\r\n+                          <p className=\"mt-1 flex items-center gap-1 text-xs text-rose-600 dark:text-rose-400\">\r\n+                            <AlertCircle size={12} />\r\n+                            {inventoryErrors[index]}\r\n+                          </p>\r\n+                        )}\r\n+                      </div>\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Unit Price (₹)</label>\r\n+                        <input\r\n+                          type=\"number\"\r\n+                          step=\"0.01\"\r\n+                          min={0}\r\n+                          {...form.register(`items.${index}.unitPrice` as const, { valueAsNumber: true })}\r\n                           className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n                         />\r\n+                        <p className=\"mt-1 text-xs text-zinc-500\">Editable for discounts</p>\r\n                       </div>\r\n                       <div className=\"flex flex-col items-end justify-between text-xs text-zinc-500\">\r\n                         <span>Line Total</span>\r\n                           <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n-                            ₹{(price * quantity).toLocaleString(\"en-IN\")}\r\n+                            ₹{(unitPrice * quantity).toLocaleString(\"en-IN\")}\r\n                         </span>\r\n                         {fields.length > 1 && (\r\n                           <button type=\"button\" onClick={() => remove(index)} className=\"text-xs text-rose-500\">\r\n                             Remove\r\n@@ -281,9 +380,19 @@\n                   <option value=\"cod\">Cash on Delivery</option>\r\n                 </select>\r\n               </div>\r\n               <div>\r\n-                <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n+                <div className=\"flex items-center justify-between\">\r\n+                  <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n+                  <button\r\n+                    type=\"button\"\r\n+                    onClick={() => setShowAddAgent(true)}\r\n+                    className=\"flex items-center gap-1 text-xs font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  >\r\n+                    <UserPlus size={14} />\r\n+                    New\r\n+                  </button>\r\n+                </div>\r\n                 <select\r\n                   {...form.register(\"deliveryAgentId\")}\r\n                   className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n                 >\r\n@@ -315,10 +424,10 @@\n                 </span>\r\n               </div>\r\n               <button\r\n                 type=\"submit\"\r\n-                disabled={submitting}\r\n-                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n+                disabled={submitting || hasInventoryErrors}\r\n+                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-50\"\r\n               >\r\n                 {submitting ? \"Creating Order...\" : \"Raise Order\"}\r\n               </button>\r\n             </div>\r\n@@ -354,12 +463,153 @@\n             loadData();\r\n           }}\r\n         />\r\n       )}\r\n+\r\n+      {/* Add Delivery Agent Dialog */}\r\n+      {showAddAgent && (\r\n+        <AddDeliveryAgentDialog\r\n+          onClose={() => setShowAddAgent(false)}\r\n+          onSuccess={(newAgentId) => {\r\n+            setShowAddAgent(false);\r\n+            loadData();\r\n+            // Auto-select the new agent\r\n+            form.setValue(\"deliveryAgentId\", newAgentId);\r\n+          }}\r\n+        />\r\n+      )}\r\n     </div>\r\n   );\r\n }\r\n \r\n+function AddDeliveryAgentDialog({\r\n+  onClose,\r\n+  onSuccess,\r\n+}: {\r\n+  onClose: () => void;\r\n+  onSuccess: (agentId: string) => void;\r\n+}) {\r\n+  const [name, setName] = useState(\"\");\r\n+  const [email, setEmail] = useState(\"\");\r\n+  const [phone, setPhone] = useState(\"\");\r\n+  const [submitting, setSubmitting] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+  const [tempPassword, setTempPassword] = useState<string | null>(null);\r\n+\r\n+  const handleSubmit = async (e: React.FormEvent) => {\r\n+    e.preventDefault();\r\n+    setSubmitting(true);\r\n+    setError(null);\r\n+\r\n+    const result = await createDeliveryAgent({ name, email, phone });\r\n+\r\n+    if (result.success && result.data) {\r\n+      setTempPassword(result.data.tempPassword);\r\n+      // Show password for 3 seconds, then auto-close\r\n+      setTimeout(() => {\r\n+        onSuccess(result.data.id);\r\n+      }, 3000);\r\n+    } else {\r\n+      setError(result.error || \"Failed to create delivery agent\");\r\n+      setSubmitting(false);\r\n+    }\r\n+  };\r\n+\r\n+  return (\r\n+    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n+      <div className=\"w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-zinc-900\">\r\n+        <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+          Add Delivery Agent\r\n+        </h3>\r\n+        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n+          Create a new delivery agent account\r\n+        </p>\r\n+\r\n+        {tempPassword ? (\r\n+          <div className=\"mt-4 rounded-lg bg-emerald-50 p-4 dark:bg-emerald-900/20\">\r\n+            <p className=\"text-sm font-semibold text-emerald-800 dark:text-emerald-200\">\r\n+              ✓ Agent created successfully!\r\n+            </p>\r\n+            <div className=\"mt-2 rounded border border-emerald-200 bg-white p-2 dark:border-emerald-800 dark:bg-zinc-800\">\r\n+              <p className=\"text-xs text-zinc-500\">Temporary Password:</p>\r\n+              <p className=\"font-mono text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                {tempPassword}\r\n+              </p>\r\n+            </div>\r\n+            <p className=\"mt-2 text-xs text-emerald-600 dark:text-emerald-400\">\r\n+              Share this password with the agent. They can change it after first login.\r\n+            </p>\r\n+          </div>\r\n+        ) : (\r\n+          <form onSubmit={handleSubmit} className=\"mt-4 space-y-4\">\r\n+            {error && (\r\n+              <div className=\"rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n+                {error}\r\n+              </div>\r\n+            )}\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Full Name\r\n+              </label>\r\n+              <input\r\n+                type=\"text\"\r\n+                required\r\n+                value={name}\r\n+                onChange={(e) => setName(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Email\r\n+              </label>\r\n+              <input\r\n+                type=\"email\"\r\n+                required\r\n+                value={email}\r\n+                onChange={(e) => setEmail(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Phone\r\n+              </label>\r\n+              <input\r\n+                type=\"tel\"\r\n+                required\r\n+                value={phone}\r\n+                onChange={(e) => setPhone(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div className=\"flex justify-end gap-3 pt-2\">\r\n+              <button\r\n+                type=\"button\"\r\n+                onClick={onClose}\r\n+                className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n+              >\r\n+                Cancel\r\n+              </button>\r\n+              <button\r\n+                type=\"submit\"\r\n+                disabled={submitting}\r\n+                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n+              >\r\n+                {submitting ? \"Creating...\" : \"Create Agent\"}\r\n+              </button>\r\n+            </div>\r\n+          </form>\r\n+        )}\r\n+      </div>\r\n+    </div>\r\n+  );\r\n+}\r\n+\r\n function formatStatus(status: string) {\r\n   return status\r\n     .split(\"_\")\r\n     .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\r\n"
                },
                {
                    "date": 1765688204673,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,698 @@\n+\"use client\";\r\n+\r\n+import { useMemo, useState, useEffect } from \"react\";\r\n+import { useForm, useFieldArray, useWatch } from \"react-hook-form\";\r\n+import { zodResolver } from \"@hookform/resolvers/zod\";\r\n+import { z } from \"zod\";\r\n+import { Card } from \"@/components/ui/card\";\r\n+import { Badge } from \"@/components/ui/badge\";\r\n+import { createOrder, getAllCustomersForDropdown, getAllInventoryItems, getDeliveryAgents, createDeliveryAgent } from \"@/app/actions/orders\";\r\n+import { AddCustomerDialog } from \"@/components/customers/add-customer-dialog\";\r\n+import { PlusCircle, UserPlus, AlertCircle } from \"lucide-react\";\r\n+\r\n+const orderSchema = z.object({\r\n+  customerId: z.string().min(1, \"Select a customer\"),\r\n+  paymentStatus: z.enum([\"cod\", \"prepaid\"]),\r\n+  deliveryAgentId: z.string().optional(),\r\n+  items: z\r\n+    .array(\r\n+      z.object({\r\n+        productId: z.string().min(1, \"Choose a product\"),\r\n+        quantity: z.number().min(1, \"Quantity must be at least 1\"),\r\n+        unitPrice: z.number().min(0, \"Price must be positive\"),\r\n+      }),\r\n+    )\r\n+    .min(1, \"Add at least one product\"),\r\n+  notes: z.string().optional(),\r\n+});\r\n+\r\n+export type OrderFormValues = z.infer<typeof orderSchema>;\r\n+\r\n+export function CreateOrderForm() {\r\n+  const [submitted, setSubmitted] = useState<OrderFormValues | null>(null);\r\n+  const [customers, setCustomers] = useState<any[]>([]);\r\n+  const [products, setProducts] = useState<any[]>([]);\r\n+  const [deliveryAgents, setDeliveryAgents] = useState<any[]>([]);\r\n+  const [loading, setLoading] = useState(true);\r\n+  const [showAddCustomer, setShowAddCustomer] = useState(false);\r\n+  const [showAddAgent, setShowAddAgent] = useState(false);\r\n+  const [submitting, setSubmitting] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+  const [customerSearchTerm, setCustomerSearchTerm] = useState(\"\");\r\n+  const [customerSearchFocused, setCustomerSearchFocused] = useState(false);\r\n+  const [inventoryErrors, setInventoryErrors] = useState<Record<number, string>>({});\r\n+\r\n+  useEffect(() => {\r\n+    loadData();\r\n+  }, []);\r\n+\r\n+  const loadData = async () => {\r\n+    setLoading(true);\r\n+    const [customersResult, productsResult, agentsResult] = await Promise.all([\r\n+      getAllCustomersForDropdown(),\r\n+      getAllInventoryItems(),\r\n+      getDeliveryAgents(),\r\n+    ]);\r\n+\r\n+    if (customersResult.success) setCustomers(customersResult.data);\r\n+    if (productsResult.success) setProducts(productsResult.data);\r\n+    if (agentsResult.success) setDeliveryAgents(agentsResult.data);\r\n+    setLoading(false);\r\n+  };\r\n+\r\n+  const form = useForm<OrderFormValues>({\r\n+    resolver: zodResolver(orderSchema),\r\n+    defaultValues: {\r\n+      customerId: \"\",\r\n+      paymentStatus: \"prepaid\",\r\n+      deliveryAgentId: \"\",\r\n+      items: [\r\n+        {\r\n+          productId: products[0]?.id || \"\",\r\n+          quantity: 1,\r\n+          unitPrice: products[0]?.selling_price || 0,\r\n+        },\r\n+      ],\r\n+    },\r\n+  });\r\n+\r\n+  const { fields, append, remove } = useFieldArray({ control: form.control, name: \"items\" });\r\n+\r\n+  const customerId = useWatch({ control: form.control, name: \"customerId\" }) ?? \"\";\r\n+  const selectedCustomer = useMemo(\r\n+    () => customers.find((customer) => customer.id === customerId),\r\n+    [customerId, customers],\r\n+  );\r\n+\r\n+  const watchedItems = useWatch({ control: form.control, name: \"items\" }) as OrderFormValues[\"items\"] | undefined;\r\n+  const items = watchedItems ?? form.getValues(\"items\");\r\n+  \r\n+  // Validate inventory in real-time\r\n+  useEffect(() => {\r\n+    const errors: Record<number, string> = {};\r\n+    items.forEach((item, index) => {\r\n+      const product = products.find((p) => p.id === item.productId);\r\n+      if (product && item.quantity > product.stock_level) {\r\n+        errors[index] = `Cannot exceed available stock (${product.stock_level})`;\r\n+      }\r\n+    });\r\n+    setInventoryErrors(errors);\r\n+  }, [items, products]);\r\n+\r\n+  const hasInventoryErrors = Object.keys(inventoryErrors).length > 0;\r\n+  \r\n+  const totalAmount = useMemo(() => {\r\n+    return items.reduce((acc, item) => {\r\n+      // Use the editable unitPrice from the form, not avg_cost\r\n+      const unitPrice = item.unitPrice || 0;\r\n+      return acc + unitPrice * item.quantity;\r\n+    }, 0);\r\n+  }, [items]);\r\n+\r\n+  const filteredCustomers = useMemo(() => {\r\n+    if (!customerSearchTerm) return customers;\r\n+    const search = customerSearchTerm.toLowerCase();\r\n+    return customers.filter(\r\n+      (c) =>\r\n+        c.name.toLowerCase().includes(search) ||\r\n+        c.phone.toLowerCase().includes(search)\r\n+    );\r\n+  }, [customers, customerSearchTerm]);\r\n+\r\n+  const showAddNewCustomerButton = customerSearchTerm.length > 0 && filteredCustomers.length === 0;\r\n+\r\n+  const handleSubmit = form.handleSubmit(async (values) => {\r\n+    setSubmitting(true);\r\n+    setError(null);\r\n+\r\n+    // Build order data with product details\r\n+    const orderData = {\r\n+      customerId: values.customerId,\r\n+      paymentStatus: values.paymentStatus,\r\n+      deliveryAgentId: values.deliveryAgentId || undefined,\r\n+      items: values.items.map((item) => {\r\n+        const product = products.find((p) => p.id === item.productId);\r\n+        return {\r\n+          productId: item.productId,\r\n+          productName: product?.item_name || \"Unknown Product\",\r\n+          quantity: item.quantity,\r\n+          unitPrice: item.unitPrice, // Use the editable price from form\r\n+        };\r\n+      }),\r\n+    };\r\n+\r\n+    const result = await createOrder(orderData);\r\n+\r\n+    if (result.success) {\r\n+      setSubmitted(values);\r\n+      form.reset();\r\n+      // Reload data to refresh inventory\r\n+      loadData();\r\n+    } else {\r\n+      setError(result.error || \"Failed to create order\");\r\n+    }\r\n+    setSubmitting(false);\r\n+  });\r\n+\r\n+  return (\r\n+    <div className=\"grid gap-6 lg:grid-cols-[3fr_2fr]\">\r\n+      <Card\r\n+        title=\"Raise New Order\"\r\n+        description=\"Capture customer request and reserve inventory.\"\r\n+        actions={<Badge variant=\"info\">Draft</Badge>}\r\n+      >\r\n+        {loading ? (\r\n+          <div className=\"py-8 text-center text-sm text-zinc-500\">Loading form data...</div>\r\n+        ) : (\r\n+          <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n+            {error && (\r\n+              <div className=\"rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n+                {error}\r\n+              </div>\r\n+            )}\r\n+\r\n+            <section className=\"space-y-4\">\r\n+              <div>\r\n+                <div className=\"flex items-center justify-between\">\r\n+                  <label htmlFor=\"customerId\" className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                    Customer\r\n+                  </label>\r\n+                  <button\r\n+                    type=\"button\"\r\n+                    onClick={() => setShowAddCustomer(true)}\r\n+                    className=\"flex items-center gap-1 text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  >\r\n+                    <PlusCircle size={16} />\r\n+                    Add New\r\n+                  </button>\r\n+                </div>\r\n+                \r\n+                {/* Searchable Customer Combobox */}\r\n+                <div className=\"relative\">\r\n+                  <input\r\n+                    type=\"text\"\r\n+                    placeholder=\"Search by name or phone...\"\r\n+                    value={customerSearchTerm}\r\n+                    onChange={(e) => {\r\n+                      setCustomerSearchTerm(e.target.value);\r\n+                      setCustomerSearchFocused(true);\r\n+                    }}\r\n+                    onFocus={() => setCustomerSearchFocused(true)}\r\n+                    className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                  />\r\n+                  \r\n+                  {/* Dropdown results */}\r\n+                  {customerSearchFocused && (customerSearchTerm.length > 0 || customerId === \"\") && (\r\n+                    <div className=\"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-lg border border-zinc-300 bg-white shadow-lg dark:border-zinc-700 dark:bg-zinc-900\">\r\n+                      {filteredCustomers.length > 0 ? (\r\n+                        filteredCustomers.map((customer) => (\r\n+                          <button\r\n+                            key={customer.id}\r\n+                            type=\"button\"\r\n+                            onClick={() => {\r\n+                              form.setValue(\"customerId\", customer.id);\r\n+                              setCustomerSearchTerm(customer.name);\r\n+                              setCustomerSearchFocused(false);\r\n+                            }}\r\n+                            className=\"w-full px-4 py-2 text-left text-sm hover:bg-emerald-50 dark:hover:bg-emerald-950/30\"\r\n+                          >\r\n+                            <div className=\"font-medium text-zinc-900 dark:text-zinc-100\">{customer.name}</div>\r\n+                            <div className=\"text-xs text-zinc-500 dark:text-zinc-400\">{customer.phone}</div>\r\n+                          </button>\r\n+                        ))\r\n+                      ) : showAddNewCustomerButton ? (\r\n+                        <button\r\n+                          type=\"button\"\r\n+                          onClick={() => {\r\n+                            setShowAddCustomer(true);\r\n+                            setCustomerSearchFocused(false);\r\n+                          }}\r\n+                          className=\"flex w-full items-center gap-2 px-4 py-3 text-left text-sm text-emerald-600 hover:bg-emerald-50 dark:text-emerald-400 dark:hover:bg-emerald-950/30\"\r\n+                        >\r\n+                          <PlusCircle size={16} />\r\n+                          <span>Add new customer &quot;{customerSearchTerm}&quot;</span>\r\n+                        </button>\r\n+                      ) : (\r\n+                        <div className=\"px-4 py-3 text-sm text-zinc-500\">Type to search customers...</div>\r\n+                      )}\r\n+                    </div>\r\n+                  )}\r\n+                </div>\r\n+                \r\n+                {/* Hidden select for form validation */}\r\n+                <input type=\"hidden\" {...form.register(\"customerId\")} />\r\n+                \r\n+                {form.formState.errors.customerId && (\r\n+                  <p className=\"mt-1 text-xs text-rose-500\">{form.formState.errors.customerId.message}</p>\r\n+                )}\r\n+              </div>\r\n+\r\n+              {selectedCustomer && (\r\n+                <div className=\"rounded-lg border border-emerald-200/60 bg-emerald-50/60 p-4 text-sm dark:border-emerald-900/40 dark:bg-emerald-950/20\">\r\n+                  <p className=\"font-semibold text-emerald-800 dark:text-emerald-200\">Delivery Address</p>\r\n+                  <p className=\"mt-1 text-emerald-700 dark:text-emerald-200/80\">{selectedCustomer.address}</p>\r\n+                  <p className=\"mt-1 text-xs text-emerald-600/80 dark:text-emerald-200/60\">\r\n+                    Family size: {selectedCustomer.family_size?.toUpperCase()} · Status: {formatStatus(selectedCustomer.status)}\r\n+                  </p>\r\n+                </div>\r\n+              )}\r\n+            </section>\r\n+\r\n+            <section className=\"space-y-4\">\r\n+              <header className=\"flex items-center justify-between\">\r\n+                <h3 className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">Products</h3>\r\n+                <button\r\n+                  type=\"button\"\r\n+                  className=\"text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  onClick={() =>\r\n+                    append({\r\n+                      productId: products[0]?.id ?? \"\",\r\n+                      quantity: 1,\r\n+                      unitPrice: products[0]?.selling_price ?? 0,\r\n+                    })\r\n+                  }\r\n+                >\r\n+                  + Add product\r\n+                </button>\r\n+              </header>\r\n+\r\n+              <div className=\"space-y-3\">\r\n+                {fields.map((field, index) => {\r\n+                    const currentItem = items[index];\r\n+                    const product = products.find((p: any) => p.id === currentItem?.productId);\r\n+                    const unitPrice = currentItem?.unitPrice ?? 0;\r\n+                    const quantity = currentItem?.quantity ?? 0;\r\n+                    const stockLevel = product?.stock_level ?? 0;\r\n+                    const hasError = !!inventoryErrors[index];\r\n+                  return (\r\n+                    <div\r\n+                      key={field.id}\r\n+                      className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_1fr_auto]\"\r\n+                    >\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Product</label>\r\n+                        <select\r\n+                          {...form.register(`items.${index}.productId` as const, {\r\n+                            onChange: (e) => {\r\n+                              // Auto-fill unit price when product changes\r\n+                              const selectedProduct = products.find((p: any) => p.id === e.target.value);\r\n+                              if (selectedProduct) {\r\n+                                form.setValue(`items.${index}.unitPrice`, selectedProduct.selling_price || 0);\r\n+                              }\r\n+                            }\r\n+                          })}\r\n+                          className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                        >\r\n+                          {products.map((product: any) => (\r\n+                            <option key={product.id} value={product.id}>\r\n+                              {product.item_name}\r\n+                            </option>\r\n+                          ))}\r\n+                        </select>\r\n+                        {product && (\r\n+                          <div className=\"mt-1 flex items-center gap-1 text-xs text-zinc-600 dark:text-zinc-400\">\r\n+                            <span className=\"font-medium\">Available:</span>\r\n+                            <Badge variant={stockLevel < 10 ? \"danger\" : \"success\"}>\r\n+                              {stockLevel} {product.unit}\r\n+                            </Badge>\r\n+                          </div>\r\n+                        )}\r\n+                      </div>\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Quantity</label>\r\n+                        <input\r\n+                          type=\"number\"\r\n+                          min={1}\r\n+                          {...form.register(`items.${index}.quantity` as const, { valueAsNumber: true })}\r\n+                          className={`mt-1 w-full rounded-lg border px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring-2 dark:bg-zinc-900 dark:text-zinc-100 ${\r\n+                            hasError\r\n+                              ? \"border-rose-500 focus:border-rose-500 focus:ring-rose-200\"\r\n+                              : \"border-zinc-300 focus:border-emerald-500 focus:ring-emerald-200 dark:border-zinc-700\"\r\n+                          }`}\r\n+                        />\r\n+                        {hasError && (\r\n+                          <p className=\"mt-1 flex items-center gap-1 text-xs text-rose-600 dark:text-rose-400\">\r\n+                            <AlertCircle size={12} />\r\n+                            {inventoryErrors[index]}\r\n+                          </p>\r\n+                        )}\r\n+                      </div>\r\n+                      <div>\r\n+                        <label className=\"text-xs font-medium uppercase text-zinc-500\">Unit Price (₹)</label>\r\n+                        <input\r\n+                          type=\"number\"\r\n+                          step=\"0.01\"\r\n+                          min={0}\r\n+                          {...form.register(`items.${index}.unitPrice` as const, { valueAsNumber: true })}\r\n+                          className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                        />\r\n+                        <p className=\"mt-1 text-xs text-zinc-500\">Editable for discounts</p>\r\n+                      </div>\r\n+                      <div className=\"flex flex-col items-end justify-between text-xs text-zinc-500\">\r\n+                        <span>Line Total</span>\r\n+                          <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                            ₹{(unitPrice * quantity).toLocaleString(\"en-IN\")}\r\n+                        </span>\r\n+                        {fields.length > 1 && (\r\n+                          <button type=\"button\" onClick={() => remove(index)} className=\"text-xs text-rose-500\">\r\n+                            Remove\r\n+                          </button>\r\n+                        )}\r\n+                      </div>\r\n+                    </div>\r\n+                  );\r\n+                })}\r\n+              </div>\r\n+\r\n+              {form.formState.errors.items && (\r\n+                <p className=\"text-xs text-rose-500\">{form.formState.errors.items.message as string}</p>\r\n+              )}\r\n+            </section>\r\n+\r\n+            <section className=\"grid gap-4 md:grid-cols-2\">\r\n+              <div>\r\n+                <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Payment Status</label>\r\n+                <select\r\n+                  {...form.register(\"paymentStatus\")}\r\n+                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"prepaid\">Prepaid</option>\r\n+                  <option value=\"cod\">Cash on Delivery</option>\r\n+                </select>\r\n+              </div>\r\n+              <div>\r\n+                <div className=\"flex items-center justify-between\">\r\n+                  <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n+                  <button\r\n+                    type=\"button\"\r\n+                    onClick={() => setShowAddAgent(true)}\r\n+                    className=\"flex items-center gap-1 text-xs font-medium text-emerald-600 hover:text-emerald-500\"\r\n+                  >\r\n+                    <UserPlus size={14} />\r\n+                    New\r\n+                  </button>\r\n+                </div>\r\n+                <select\r\n+                  {...form.register(\"deliveryAgentId\")}\r\n+                  className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"\">Unassigned</option>\r\n+                  {deliveryAgents.map((agent: any) => (\r\n+                    <option key={agent.id} value={agent.id}>\r\n+                      {agent.full_name}\r\n+                    </option>\r\n+                  ))}\r\n+                </select>\r\n+              </div>\r\n+            </section>\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Internal Notes</label>\r\n+              <textarea\r\n+                {...form.register(\"notes\")}\r\n+                rows={3}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                placeholder=\"Delivery preference, packaging instructions, etc.\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div className=\"flex items-center justify-between border-t border-zinc-200 pt-4 text-sm dark:border-zinc-800\">\r\n+              <div className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n+                Total\r\n+                <span className=\"ml-2 text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                  ₹{totalAmount.toLocaleString(\"en-IN\")}\r\n+                </span>\r\n+              </div>\r\n+              <button\r\n+                type=\"submit\"\r\n+                disabled={submitting || hasInventoryErrors}\r\n+                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:cursor-not-allowed disabled:opacity-50\"\r\n+              >\r\n+                {submitting ? \"Creating Order...\" : \"Raise Order\"}\r\n+              </button>\r\n+            </div>\r\n+          </form>\r\n+        )}\r\n+      </Card>\r\n+\r\n+      <Card title={submitted ? \"Order Confirmation\" : \"Live Preview\"} description={submitted ? \"Order has been created successfully\" : \"Updates as you type\"}>\r\n+        {submitted || (items.length > 0 && customerId) ? (\r\n+          <div className=\"space-y-4\">\r\n+            {/* Success Banner (only after submission) */}\r\n+            {submitted && (\r\n+              <div className=\"rounded-lg bg-emerald-50 p-3 dark:bg-emerald-900/20\">\r\n+                <p className=\"text-sm font-semibold text-emerald-800 dark:text-emerald-200\">\r\n+                  ✓ Order created successfully!\r\n+                </p>\r\n+              </div>\r\n+            )}\r\n+\r\n+            {/* Customer Section */}\r\n+            {selectedCustomer && (\r\n+              <div className=\"space-y-2\">\r\n+                <h4 className=\"text-xs font-semibold uppercase tracking-wide text-zinc-500 dark:text-zinc-400\">\r\n+                  Customer\r\n+                </h4>\r\n+                <div className=\"rounded-lg border border-zinc-200 bg-zinc-50 p-3 dark:border-zinc-800 dark:bg-zinc-900/50\">\r\n+                  <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">{selectedCustomer.name}</p>\r\n+                  <p className=\"text-sm text-zinc-600 dark:text-zinc-400\">{selectedCustomer.phone}</p>\r\n+                  <p className=\"mt-1 text-xs text-zinc-500 dark:text-zinc-500\">{selectedCustomer.address}</p>\r\n+                </div>\r\n+              </div>\r\n+            )}\r\n+\r\n+            {/* Items Section */}\r\n+            <div className=\"space-y-2\">\r\n+              <h4 className=\"text-xs font-semibold uppercase tracking-wide text-zinc-500 dark:text-zinc-400\">\r\n+                Order Items\r\n+              </h4>\r\n+              <div className=\"space-y-2\">\r\n+                {items.map((item, index) => {\r\n+                  const product = products.find((p) => p.id === item.productId);\r\n+                  const unitPrice = item.unitPrice || 0;\r\n+                  const quantity = item.quantity || 0;\r\n+                  const lineTotal = unitPrice * quantity;\r\n+\r\n+                  return (\r\n+                    <div\r\n+                      key={index}\r\n+                      className=\"flex items-start justify-between rounded-lg border border-zinc-200 bg-white p-3 dark:border-zinc-800 dark:bg-zinc-900\"\r\n+                    >\r\n+                      <div className=\"flex-1\">\r\n+                        <p className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                          {product?.item_name || \"Unknown Product\"}\r\n+                        </p>\r\n+                        <p className=\"text-xs text-zinc-500 dark:text-zinc-400\">\r\n+                          {quantity} {product?.unit || \"units\"} × ₹{unitPrice.toLocaleString(\"en-IN\")}\r\n+                        </p>\r\n+                      </div>\r\n+                      <div className=\"text-right\">\r\n+                        <p className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                          ₹{lineTotal.toLocaleString(\"en-IN\")}\r\n+                        </p>\r\n+                      </div>\r\n+                    </div>\r\n+                  );\r\n+                })}\r\n+              </div>\r\n+            </div>\r\n+\r\n+            {/* Summary Section */}\r\n+            <div className=\"space-y-3 border-t border-zinc-200 pt-4 dark:border-zinc-800\">\r\n+              <div className=\"flex items-center justify-between text-sm\">\r\n+                <span className=\"text-zinc-600 dark:text-zinc-400\">Payment Status</span>\r\n+                <Badge variant={form.getValues(\"paymentStatus\") === \"prepaid\" ? \"success\" : \"warning\"}>\r\n+                  {form.getValues(\"paymentStatus\") === \"prepaid\" ? \"Prepaid\" : \"Cash on Delivery\"}\r\n+                </Badge>\r\n+              </div>\r\n+\r\n+              <div className=\"flex items-center justify-between text-sm\">\r\n+                <span className=\"text-zinc-600 dark:text-zinc-400\">Delivery Agent</span>\r\n+                <span className=\"font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                  {(() => {\r\n+                    const agentId = form.getValues(\"deliveryAgentId\");\r\n+                    const agent = deliveryAgents.find((a: any) => a.id === agentId);\r\n+                    return agent ? agent.full_name : \"Unassigned\";\r\n+                  })()}\r\n+                </span>\r\n+              </div>\r\n+\r\n+              {/* Grand Total */}\r\n+              <div className=\"flex items-center justify-between border-t border-zinc-200 pt-3 dark:border-zinc-800\">\r\n+                <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">Grand Total</span>\r\n+                <span className=\"text-2xl font-bold text-emerald-600 dark:text-emerald-400\">\r\n+                  ₹{totalAmount.toLocaleString(\"en-IN\")}\r\n+                </span>\r\n+              </div>\r\n+            </div>\r\n+          </div>\r\n+        ) : (\r\n+          <div className=\"py-12 text-center\">\r\n+            <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n+              Select a customer and add products to see the order summary\r\n+            </p>\r\n+          </div>\r\n+        )}\r\n+      </Card>\r\n+\r\n+      {/* Add Customer Dialog */}\r\n+      {showAddCustomer && (\r\n+        <AddCustomerDialog\r\n+          onClose={() => setShowAddCustomer(false)}\r\n+          onSuccess={() => {\r\n+            setShowAddCustomer(false);\r\n+            loadData();\r\n+          }}\r\n+        />\r\n+      )}\r\n+\r\n+      {/* Add Delivery Agent Dialog */}\r\n+      {showAddAgent && (\r\n+        <AddDeliveryAgentDialog\r\n+          onClose={() => setShowAddAgent(false)}\r\n+          onSuccess={(newAgentId) => {\r\n+            setShowAddAgent(false);\r\n+            loadData();\r\n+            // Auto-select the new agent\r\n+            form.setValue(\"deliveryAgentId\", newAgentId);\r\n+          }}\r\n+        />\r\n+      )}\r\n+    </div>\r\n+  );\r\n+}\r\n+\r\n+function AddDeliveryAgentDialog({\r\n+  onClose,\r\n+  onSuccess,\r\n+}: {\r\n+  onClose: () => void;\r\n+  onSuccess: (agentId: string) => void;\r\n+}) {\r\n+  const [name, setName] = useState(\"\");\r\n+  const [email, setEmail] = useState(\"\");\r\n+  const [phone, setPhone] = useState(\"\");\r\n+  const [submitting, setSubmitting] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+  const [tempPassword, setTempPassword] = useState<string | null>(null);\r\n+\r\n+  const handleSubmit = async (e: React.FormEvent) => {\r\n+    e.preventDefault();\r\n+    setSubmitting(true);\r\n+    setError(null);\r\n+\r\n+    const result = await createDeliveryAgent({ name, email, phone });\r\n+\r\n+    if (result.success && result.data) {\r\n+      setTempPassword(result.data.tempPassword);\r\n+      // Show password for 3 seconds, then auto-close\r\n+      setTimeout(() => {\r\n+        onSuccess(result.data.id);\r\n+      }, 3000);\r\n+    } else {\r\n+      setError(result.error || \"Failed to create delivery agent\");\r\n+      setSubmitting(false);\r\n+    }\r\n+  };\r\n+\r\n+  return (\r\n+    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n+      <div className=\"w-full max-w-md rounded-xl bg-white p-6 shadow-2xl dark:bg-zinc-900\">\r\n+        <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+          Add Delivery Agent\r\n+        </h3>\r\n+        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n+          Create a new delivery agent account\r\n+        </p>\r\n+\r\n+        {tempPassword ? (\r\n+          <div className=\"mt-4 rounded-lg bg-emerald-50 p-4 dark:bg-emerald-900/20\">\r\n+            <p className=\"text-sm font-semibold text-emerald-800 dark:text-emerald-200\">\r\n+              ✓ Agent created successfully!\r\n+            </p>\r\n+            <div className=\"mt-2 rounded border border-emerald-200 bg-white p-2 dark:border-emerald-800 dark:bg-zinc-800\">\r\n+              <p className=\"text-xs text-zinc-500\">Temporary Password:</p>\r\n+              <p className=\"font-mono text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+                {tempPassword}\r\n+              </p>\r\n+            </div>\r\n+            <p className=\"mt-2 text-xs text-emerald-600 dark:text-emerald-400\">\r\n+              Share this password with the agent. They can change it after first login.\r\n+            </p>\r\n+          </div>\r\n+        ) : (\r\n+          <form onSubmit={handleSubmit} className=\"mt-4 space-y-4\">\r\n+            {error && (\r\n+              <div className=\"rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n+                {error}\r\n+              </div>\r\n+            )}\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Full Name\r\n+              </label>\r\n+              <input\r\n+                type=\"text\"\r\n+                required\r\n+                value={name}\r\n+                onChange={(e) => setName(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Email\r\n+              </label>\r\n+              <input\r\n+                type=\"email\"\r\n+                required\r\n+                value={email}\r\n+                onChange={(e) => setEmail(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div>\r\n+              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+                Phone\r\n+              </label>\r\n+              <input\r\n+                type=\"tel\"\r\n+                required\r\n+                value={phone}\r\n+                onChange={(e) => setPhone(e.target.value)}\r\n+                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+              />\r\n+            </div>\r\n+\r\n+            <div className=\"flex justify-end gap-3 pt-2\">\r\n+              <button\r\n+                type=\"button\"\r\n+                onClick={onClose}\r\n+                className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n+              >\r\n+                Cancel\r\n+              </button>\r\n+              <button\r\n+                type=\"submit\"\r\n+                disabled={submitting}\r\n+                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n+              >\r\n+                {submitting ? \"Creating...\" : \"Create Agent\"}\r\n+              </button>\r\n+            </div>\r\n+          </form>\r\n+        )}\r\n+      </div>\r\n+    </div>\r\n+  );\r\n+}\r\n+\r\n+function formatStatus(status: string) {\r\n+  return status\r\n+    .split(\"_\")\r\n+    .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\r\n+    .join(\" \");\r\n+}\r\n"
                },
                {
                    "date": 1765689370607,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -207,9 +207,9 @@\n           unitPrice: products[0]?.selling_price || 0,\r\n         },\r\n       ],\r\n     });\r\n-  };   };\r\n+  };   },\r\n       }),\r\n     };\r\n \r\n     const result = await createOrder(orderData);\r\n"
                }
            ],
            "date": 1763069565217,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { useForm, useFieldArray, useWatch } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { z } from \"zod\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { customers, deliveryAgents, productCatalog } from \"@/lib/sample-data\";\r\n\r\nconst orderSchema = z.object({\r\n  customerId: z.string().min(1, \"Select a customer\"),\r\n  paymentStatus: z.enum([\"cod\", \"prepaid\"]),\r\n  deliveryAgentId: z.string().optional(),\r\n  items: z\r\n    .array(\r\n      z.object({\r\n        productId: z.string().min(1, \"Choose a product\"),\r\n        quantity: z.number().min(1, \"Quantity must be at least 1\"),\r\n      }),\r\n    )\r\n    .min(1, \"Add at least one product\"),\r\n  notes: z.string().optional(),\r\n});\r\n\r\nexport type OrderFormValues = z.infer<typeof orderSchema>;\r\n\r\nexport function CreateOrderForm() {\r\n  const [submitted, setSubmitted] = useState<OrderFormValues | null>(null);\r\n\r\n  const form = useForm<OrderFormValues>({\r\n    resolver: zodResolver(orderSchema),\r\n    defaultValues: {\r\n      customerId: \"\",\r\n      paymentStatus: \"prepaid\",\r\n      deliveryAgentId: deliveryAgents[0]?.id,\r\n      items: [\r\n        {\r\n          productId: productCatalog[0]?.id ?? \"\",\r\n          quantity: 1,\r\n        },\r\n      ],\r\n    },\r\n  });\r\n\r\n  const { fields, append, remove } = useFieldArray({ control: form.control, name: \"items\" });\r\n\r\n  const customerId = useWatch({ control: form.control, name: \"customerId\" }) ?? \"\";\r\n  const selectedCustomer = useMemo(\r\n    () => customers.find((customer) => customer.id === customerId),\r\n    [customerId],\r\n  );\r\n\r\n  const watchedItems = useWatch({ control: form.control, name: \"items\" }) as OrderFormValues[\"items\"] | undefined;\r\n  const items = watchedItems ?? form.getValues(\"items\");\r\n  const totalAmount = useMemo(() => {\r\n    return items.reduce((acc, item) => {\r\n      const product = productCatalog.find((product) => product.id === item.productId);\r\n      if (!product) return acc;\r\n      return acc + product.unitPrice * item.quantity;\r\n    }, 0);\r\n  }, [items]);\r\n\r\n  const handleSubmit = form.handleSubmit((values) => {\r\n    setSubmitted(values);\r\n  });\r\n\r\n  return (\r\n    <div className=\"grid gap-6 lg:grid-cols-[3fr_2fr]\">\r\n      <Card\r\n        title=\"Raise New Order\"\r\n        description=\"Capture customer request and reserve inventory.\"\r\n        actions={<Badge variant=\"info\">Draft</Badge>}\r\n      >\r\n        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n          <section className=\"space-y-4\">\r\n            <div>\r\n              <label htmlFor=\"customerId\" className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n                Customer\r\n              </label>\r\n              <select\r\n                id=\"customerId\"\r\n                {...form.register(\"customerId\")}\r\n                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n              >\r\n                <option value=\"\">Select customer</option>\r\n                {customers.map((customer) => (\r\n                  <option key={customer.id} value={customer.id}>\r\n                    {customer.name} · {customer.phone}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n              {form.formState.errors.customerId && (\r\n                <p className=\"mt-1 text-xs text-rose-500\">{form.formState.errors.customerId.message}</p>\r\n              )}\r\n            </div>\r\n\r\n            {selectedCustomer && (\r\n              <div className=\"rounded-lg border border-emerald-200/60 bg-emerald-50/60 p-4 text-sm dark:border-emerald-900/40 dark:bg-emerald-950/20\">\r\n                <p className=\"font-semibold text-emerald-800 dark:text-emerald-200\">Delivery Address</p>\r\n                <p className=\"mt-1 text-emerald-700 dark:text-emerald-200/80\">{selectedCustomer.address}</p>\r\n                <p className=\"mt-1 text-xs text-emerald-600/80 dark:text-emerald-200/60\">\r\n                  Family size: {selectedCustomer.familySize.toUpperCase()} · Status: {formatStatus(selectedCustomer.status)}\r\n                </p>\r\n              </div>\r\n            )}\r\n          </section>\r\n\r\n          <section className=\"space-y-4\">\r\n            <header className=\"flex items-center justify-between\">\r\n              <h3 className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">Products</h3>\r\n              <button\r\n                type=\"button\"\r\n                className=\"text-sm font-medium text-emerald-600 hover:text-emerald-500\"\r\n                onClick={() =>\r\n                  append({\r\n                    productId: productCatalog[0]?.id ?? \"\",\r\n                    quantity: 1,\r\n                  })\r\n                }\r\n              >\r\n                + Add product\r\n              </button>\r\n            </header>\r\n\r\n            <div className=\"space-y-3\">\r\n              {fields.map((field, index) => {\r\n                  const currentItem = items[index];\r\n                  const price = productCatalog.find((product) => product.id === currentItem?.productId)?.unitPrice ?? 0;\r\n                  const quantity = currentItem?.quantity ?? 0;\r\n                return (\r\n                  <div\r\n                    key={field.id}\r\n                    className=\"grid gap-3 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900 sm:grid-cols-[2fr_1fr_auto]\"\r\n                  >\r\n                    <div>\r\n                      <label className=\"text-xs font-medium uppercase text-zinc-500\">Product</label>\r\n                      <select\r\n                        {...form.register(`items.${index}.productId` as const)}\r\n                        className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n                      >\r\n                        {productCatalog.map((product) => (\r\n                          <option key={product.id} value={product.id}>\r\n                            {product.name} · ₹{product.unitPrice}\r\n                          </option>\r\n                        ))}\r\n                      </select>\r\n                    </div>\r\n                    <div>\r\n                      <label className=\"text-xs font-medium uppercase text-zinc-500\">Quantity</label>\r\n                      <input\r\n                        type=\"number\"\r\n                        min={1}\r\n                        {...form.register(`items.${index}.quantity` as const, { valueAsNumber: true })}\r\n                        className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n                      />\r\n                    </div>\r\n                    <div className=\"flex flex-col items-end justify-between text-xs text-zinc-500\">\r\n                      <span>Line Total</span>\r\n                        <span className=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                          ₹{(price * quantity).toLocaleString(\"en-IN\")}\r\n                      </span>\r\n                      {fields.length > 1 && (\r\n                        <button type=\"button\" onClick={() => remove(index)} className=\"text-xs text-rose-500\">\r\n                          Remove\r\n                        </button>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            {form.formState.errors.items && (\r\n              <p className=\"text-xs text-rose-500\">{form.formState.errors.items.message as string}</p>\r\n            )}\r\n          </section>\r\n\r\n          <section className=\"grid gap-4 md:grid-cols-2\">\r\n            <div>\r\n              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Payment Status</label>\r\n              <select\r\n                {...form.register(\"paymentStatus\")}\r\n                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n              >\r\n                <option value=\"prepaid\">Prepaid</option>\r\n                <option value=\"cod\">Cash on Delivery</option>\r\n              </select>\r\n            </div>\r\n            <div>\r\n              <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Assign Delivery Agent</label>\r\n              <select\r\n                {...form.register(\"deliveryAgentId\")}\r\n                className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n              >\r\n                <option value=\"\">Unassigned</option>\r\n                {deliveryAgents.map((agent) => (\r\n                  <option key={agent.id} value={agent.id}>\r\n                    {agent.name}\r\n                  </option>\r\n                ))}\r\n              </select>\r\n            </div>\r\n          </section>\r\n\r\n          <div>\r\n            <label className=\"text-sm font-medium text-zinc-900 dark:text-zinc-100\">Internal Notes</label>\r\n            <textarea\r\n              {...form.register(\"notes\")}\r\n              rows={3}\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n              placeholder=\"Delivery preference, packaging instructions, etc.\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between border-t border-zinc-200 pt-4 text-sm dark:border-zinc-800\">\r\n            <div className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n              Total\r\n              <span className=\"ml-2 text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                ₹{totalAmount.toLocaleString(\"en-IN\")}\r\n              </span>\r\n            </div>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n            >\r\n              Raise Order\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </Card>\r\n\r\n      <Card title=\"Preview\" description=\"This is what will be synced to Supabase.\">\r\n        {submitted ? (\r\n          <pre className=\"max-h-[460px] overflow-auto rounded-lg bg-zinc-900 p-4 text-xs text-emerald-200\">\r\n{JSON.stringify(submitted, null, 2)}\r\n          </pre>\r\n        ) : (\r\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n            Fill the order form to preview payload details before pushing to the database.\r\n          </p>\r\n        )}\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction formatStatus(status: string) {\r\n  return status\r\n    .split(\"_\")\r\n    .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\r\n    .join(\" \");\r\n}\r\n"
        }
    ]
}