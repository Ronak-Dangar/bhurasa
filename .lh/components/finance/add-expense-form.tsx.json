{
    "sourceFile": "components/finance/add-expense-form.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1763136497313,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763363343224,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,22 +1,36 @@\n \"use client\";\r\n \r\n-import { useState } from \"react\";\r\n+import { useState, useEffect } from \"react\";\r\n import { Card } from \"@/components/ui/card\";\r\n import { addExpense } from \"@/app/actions/finance\";\r\n \r\n const expenseCategories = [\r\n-  { value: \"purchase_groundnuts\", label: \"Purchase Groundnuts\" },\r\n-  { value: \"transport\", label: \"Transport\" },\r\n-  { value: \"labor\", label: \"Labor\" },\r\n-  { value: \"maintenance\", label: \"Maintenance\" },\r\n-  { value: \"utilities\", label: \"Utilities\" },\r\n+  { value: \"purchase_groundnuts\", label: \"Purchase Groundnuts\", procurement: true },\r\n+  { value: \"transport\", label: \"Transport\", procurement: false },\r\n+  { value: \"labor\", label: \"Labor\", procurement: false },\r\n+  { value: \"maintenance\", label: \"Maintenance\", procurement: false },\r\n+  { value: \"utilities\", label: \"Utilities\", procurement: false },\r\n ];\r\n \r\n export function AddExpenseForm() {\r\n   const [isOpen, setIsOpen] = useState(false);\r\n   const [isSubmitting, setIsSubmitting] = useState(false);\r\n+  const [selectedCategory, setSelectedCategory] = useState(\"purchase_groundnuts\");\r\n+  const [inventoryItems, setInventoryItems] = useState<any[]>([]);\r\n \r\n+  const isProcurement = expenseCategories.find(c => c.value === selectedCategory)?.procurement || false;\r\n+\r\n+  useEffect(() => {\r\n+    if (isProcurement && isOpen) {\r\n+      // Fetch inventory items for procurement categories\r\n+      fetch('/api/inventory-items')\r\n+        .then(res => res.json())\r\n+        .then(data => setInventoryItems(data.items || []))\r\n+        .catch(() => setInventoryItems([]));\r\n+    }\r\n+  }, [isProcurement, isOpen]);\r\n+\r\n   async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\r\n     event.preventDefault();\r\n     setIsSubmitting(true);\r\n \r\n@@ -25,8 +39,12 @@\n \r\n     if (result.success) {\r\n       setIsOpen(false);\r\n       (event.target as HTMLFormElement).reset();\r\n+      setSelectedCategory(\"purchase_groundnuts\");\r\n+      if (result.message) {\r\n+        alert(result.message);\r\n+      }\r\n     } else {\r\n       alert(`Error: ${result.error}`);\r\n     }\r\n \r\n@@ -81,8 +99,10 @@\n             </label>\r\n             <select\r\n               name=\"expense_type\"\r\n               required\r\n+              value={selectedCategory}\r\n+              onChange={(e) => setSelectedCategory(e.target.value)}\r\n               className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n             >\r\n               {expenseCategories.map((cat) => (\r\n                 <option key={cat.value} value={cat.value}>\r\n@@ -106,8 +126,53 @@\n             </select>\r\n           </div>\r\n         </div>\r\n \r\n+        {isProcurement && (\r\n+          <div className=\"rounded-lg border border-emerald-200 bg-emerald-50/60 p-4 dark:border-emerald-900/40 dark:bg-emerald-950/30\">\r\n+            <h4 className=\"mb-3 text-sm font-semibold text-emerald-900 dark:text-emerald-100\">\r\n+              üì¶ Inventory Update (ERP Bridge)\r\n+            </h4>\r\n+            <div className=\"grid gap-4 md:grid-cols-2\">\r\n+              <div>\r\n+                <label className=\"block text-sm font-medium text-emerald-900 dark:text-emerald-100\">\r\n+                  Inventory Item\r\n+                </label>\r\n+                <select\r\n+                  name=\"inventory_item_id\"\r\n+                  required={isProcurement}\r\n+                  className=\"mt-1 w-full rounded-lg border border-emerald-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-emerald-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                >\r\n+                  <option value=\"\">Select item...</option>\r\n+                  {inventoryItems.map((item) => (\r\n+                    <option key={item.id} value={item.id}>\r\n+                      {item.item_name} (Current: {item.stock_level} {item.unit})\r\n+                    </option>\r\n+                  ))}\r\n+                </select>\r\n+              </div>\r\n+\r\n+              <div>\r\n+                <label className=\"block text-sm font-medium text-emerald-900 dark:text-emerald-100\">\r\n+                  Quantity Purchased\r\n+                </label>\r\n+                <input\r\n+                  type=\"number\"\r\n+                  name=\"procurement_quantity\"\r\n+                  step=\"0.1\"\r\n+                  min=\"0\"\r\n+                  required={isProcurement}\r\n+                  placeholder=\"e.g., 1000 kg\"\r\n+                  className=\"mt-1 w-full rounded-lg border border-emerald-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-emerald-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n+                />\r\n+              </div>\r\n+            </div>\r\n+            <p className=\"mt-2 text-xs text-emerald-700 dark:text-emerald-300\">\r\n+              ‚ÑπÔ∏è Stock level and weighted average cost will be automatically updated\r\n+            </p>\r\n+          </div>\r\n+        )}\r\n+\r\n         <div>\r\n           <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n             Notes\r\n           </label>\r\n"
                }
            ],
            "date": 1763136497313,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { addExpense } from \"@/app/actions/finance\";\r\n\r\nconst expenseCategories = [\r\n  { value: \"purchase_groundnuts\", label: \"Purchase Groundnuts\" },\r\n  { value: \"transport\", label: \"Transport\" },\r\n  { value: \"labor\", label: \"Labor\" },\r\n  { value: \"maintenance\", label: \"Maintenance\" },\r\n  { value: \"utilities\", label: \"Utilities\" },\r\n];\r\n\r\nexport function AddExpenseForm() {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\r\n    event.preventDefault();\r\n    setIsSubmitting(true);\r\n\r\n    const formData = new FormData(event.currentTarget);\r\n    const result = await addExpense(formData);\r\n\r\n    if (result.success) {\r\n      setIsOpen(false);\r\n      (event.target as HTMLFormElement).reset();\r\n    } else {\r\n      alert(`Error: ${result.error}`);\r\n    }\r\n\r\n    setIsSubmitting(false);\r\n  }\r\n\r\n  if (!isOpen) {\r\n    return (\r\n      <button\r\n        onClick={() => setIsOpen(true)}\r\n        className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n      >\r\n        + Log New Expense\r\n      </button>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Card title=\"Add Expense\" description=\"Record a new business expense\">\r\n      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n        <div className=\"grid gap-4 md:grid-cols-2\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n              Date\r\n            </label>\r\n            <input\r\n              type=\"date\"\r\n              name=\"expense_date\"\r\n              required\r\n              defaultValue={new Date().toISOString().split(\"T\")[0]}\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n              Amount (‚Çπ)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              name=\"amount\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              required\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n              Category\r\n            </label>\r\n            <select\r\n              name=\"expense_type\"\r\n              required\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            >\r\n              {expenseCategories.map((cat) => (\r\n                <option key={cat.value} value={cat.value}>\r\n                  {cat.label}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n              Status\r\n            </label>\r\n            <select\r\n              name=\"status\"\r\n              defaultValue=\"paid\"\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            >\r\n              <option value=\"paid\">Paid</option>\r\n              <option value=\"unpaid\">Unpaid</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n            Notes\r\n          </label>\r\n          <textarea\r\n            name=\"description\"\r\n            rows={2}\r\n            className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            placeholder=\"Optional description or vendor details\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex items-center justify-end gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setIsOpen(false)}\r\n            className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 transition hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isSubmitting}\r\n            className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n          >\r\n            {isSubmitting ? \"Saving...\" : \"Add Expense\"}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </Card>\r\n  );\r\n}\r\n"
        }
    ]
}