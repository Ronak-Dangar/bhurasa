{
    "sourceFile": "components/finance/loan-management.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763136497314,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763136497314,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Table, THead, TBody, TH, TD } from \"@/components/ui/table\";\r\nimport { addLoanTransaction } from \"@/app/actions/finance\";\r\n\r\ninterface Loan {\r\n  id: string;\r\n  lender_name: string;\r\n  initial_amount: number;\r\n  current_balance: number;\r\n  interest_rate_pa: number | null;\r\n  created_at: string;\r\n}\r\n\r\ninterface LoanManagementProps {\r\n  loans: Loan[];\r\n}\r\n\r\nexport function LoanManagement({ loans }: LoanManagementProps) {\r\n  const [activeModal, setActiveModal] = useState<{\r\n    loanId: string;\r\n    type: \"payment\" | \"interest\";\r\n  } | null>(null);\r\n\r\n  return (\r\n    <>\r\n      <Card\r\n        title=\"Loan Management\"\r\n        description=\"Track outstanding loans and record transactions\"\r\n      >\r\n        {loans.length === 0 ? (\r\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n            No active loans recorded.\r\n          </p>\r\n        ) : (\r\n          <Table>\r\n            <THead>\r\n              <tr>\r\n                <TH>Lender</TH>\r\n                <TH>Initial Amount</TH>\r\n                <TH>Current Balance</TH>\r\n                <TH>Interest Rate</TH>\r\n                <TH>Actions</TH>\r\n              </tr>\r\n            </THead>\r\n            <TBody>\r\n              {loans.map((loan) => (\r\n                <tr key={loan.id}>\r\n                  <TD className=\"font-medium text-zinc-900 dark:text-zinc-100\">\r\n                    {loan.lender_name}\r\n                  </TD>\r\n                  <TD>₹{loan.initial_amount.toLocaleString(\"en-IN\")}</TD>\r\n                  <TD>\r\n                    <span className=\"font-semibold text-zinc-900 dark:text-zinc-100\">\r\n                      ₹{loan.current_balance.toLocaleString(\"en-IN\")}\r\n                    </span>\r\n                  </TD>\r\n                  <TD>\r\n                    {loan.interest_rate_pa ? `${loan.interest_rate_pa}% p.a.` : \"—\"}\r\n                  </TD>\r\n                  <TD>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <button\r\n                        onClick={() =>\r\n                          setActiveModal({ loanId: loan.id, type: \"interest\" })\r\n                        }\r\n                        className=\"rounded border border-amber-200 bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700 hover:bg-amber-100 dark:border-amber-900/40 dark:bg-amber-950/30 dark:text-amber-200\"\r\n                      >\r\n                        Log Interest\r\n                      </button>\r\n                      <button\r\n                        onClick={() =>\r\n                          setActiveModal({ loanId: loan.id, type: \"payment\" })\r\n                        }\r\n                        className=\"rounded bg-emerald-600 px-2 py-1 text-xs font-medium text-white hover:bg-emerald-500\"\r\n                      >\r\n                        Log Payment\r\n                      </button>\r\n                    </div>\r\n                  </TD>\r\n                </tr>\r\n              ))}\r\n            </TBody>\r\n          </Table>\r\n        )}\r\n      </Card>\r\n\r\n      {activeModal && (\r\n        <LoanTransactionModal\r\n          loanId={activeModal.loanId}\r\n          type={activeModal.type}\r\n          loanName={\r\n            loans.find((l) => l.id === activeModal.loanId)?.lender_name ?? \"\"\r\n          }\r\n          onClose={() => setActiveModal(null)}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\ninterface LoanTransactionModalProps {\r\n  loanId: string;\r\n  type: \"payment\" | \"interest\";\r\n  loanName: string;\r\n  onClose: () => void;\r\n}\r\n\r\nfunction LoanTransactionModal({\r\n  loanId,\r\n  type,\r\n  loanName,\r\n  onClose,\r\n}: LoanTransactionModalProps) {\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  async function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\r\n    event.preventDefault();\r\n    setIsSubmitting(true);\r\n\r\n    const formData = new FormData(event.currentTarget);\r\n    formData.append(\"loan_id\", loanId);\r\n    formData.append(\"type\", type);\r\n\r\n    const result = await addLoanTransaction(formData);\r\n\r\n    if (result.success) {\r\n      onClose();\r\n    } else {\r\n      alert(`Error: ${result.error}`);\r\n    }\r\n\r\n    setIsSubmitting(false);\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n      <div className=\"w-full max-w-md rounded-xl border border-zinc-200 bg-white p-6 shadow-xl dark:border-zinc-800 dark:bg-zinc-900\">\r\n        <div className=\"mb-4\">\r\n          <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n            {type === \"payment\" ? \"Log Payment\" : \"Log Interest\"}\r\n          </h3>\r\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n            {loanName}\r\n          </p>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n              Amount (₹)\r\n            </label>\r\n            <input\r\n              type=\"number\"\r\n              name=\"amount\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              required\r\n              autoFocus\r\n              className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-end gap-3 pt-2\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 transition hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              disabled={isSubmitting}\r\n              className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500 disabled:opacity-50\"\r\n            >\r\n              {isSubmitting ? \"Saving...\" : \"Record Transaction\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"
        }
    ]
}