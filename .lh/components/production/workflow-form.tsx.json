{
    "sourceFile": "components/production/workflow-form.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1763069565217,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763303391915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,314 +1,36 @@\n-\"use client\";\r\n-\r\n-import { useMemo, useState } from \"react\";\r\n-import { useForm, useWatch } from \"react-hook-form\";\r\n-import { zodResolver } from \"@hookform/resolvers/zod\";\r\n-import { z } from \"zod\";\r\n-import { Badge } from \"@/components/ui/badge\";\r\n import { Card } from \"@/components/ui/card\";\r\n+import { ProductionWorkflowForm } from \"@/components/production/workflow-form\";\r\n+import { productionBatches } from \"@/lib/sample-data\";\r\n \r\n-const productionSchema = z.object({\r\n-  batchId: z.string().min(1),\r\n-  farmerName: z.string().min(1),\r\n-  pressedOn: z.string().min(1),\r\n-  inputGroundnuts: z.number().positive(),\r\n-  dehuskedPeanuts: z.number().min(0),\r\n-  pressingOil: z.number().min(0),\r\n-  pressingCake: z.number().min(0),\r\n-  pressingHusk: z.number().min(0),\r\n-  bottling1L: z.number().min(0),\r\n-  bottling5L: z.number().min(0),\r\n-  bottling15L: z.number().min(0),\r\n-  bottlingLabels: z.number().min(0),\r\n-});\r\n+export default function ProductionPage() {\r\n+  const upcoming = productionBatches.filter((batch) => batch.phase !== \"bottling\");\r\n \r\n-export type ProductionFormValues = z.infer<typeof productionSchema>;\r\n-\r\n-const steps = [\r\n-  { id: \"dehusking\", title: \"Phase 1 · De-husking\", description: \"Convert groundnuts to clean peanuts.\" },\r\n-  { id: \"pressing\", title: \"Phase 2 · Pressing\", description: \"Capture oil and byproducts.\" },\r\n-  { id: \"bottling\", title: \"Phase 3 · Bottling\", description: \"Package finished oil for sale.\" },\r\n-];\r\n-\r\n-export function ProductionWorkflowForm() {\r\n-  const [step, setStep] = useState(0);\r\n-  const [submitted, setSubmitted] = useState<ProductionFormValues | null>(null);\r\n-\r\n-  const form = useForm<ProductionFormValues>({\r\n-    resolver: zodResolver(productionSchema),\r\n-    defaultValues: {\r\n-      batchId: \"batch-24d\",\r\n-      farmerName: \"Aravind Farms\",\r\n-      pressedOn: new Date().toISOString().split(\"T\")[0],\r\n-      inputGroundnuts: 280,\r\n-      dehuskedPeanuts: 0,\r\n-      pressingOil: 0,\r\n-      pressingCake: 0,\r\n-      pressingHusk: 0,\r\n-      bottling1L: 0,\r\n-      bottling5L: 0,\r\n-      bottling15L: 0,\r\n-      bottlingLabels: 0,\r\n-    },\r\n-  });\r\n-\r\n-  const dehuskedPeanuts = (useWatch({ control: form.control, name: \"dehuskedPeanuts\" }) as number | undefined) ?? 0;\r\n-  const pressingOil = (useWatch({ control: form.control, name: \"pressingOil\" }) as number | undefined) ?? 0;\r\n-\r\n-  const estimatedOilYield = useMemo(() => {\r\n-    if (dehuskedPeanuts <= 0) return 0;\r\n-    return Math.round(dehuskedPeanuts * 0.62);\r\n-  }, [dehuskedPeanuts]);\r\n-\r\n-  const pendingLiters = Math.max(estimatedOilYield - pressingOil, 0);\r\n-\r\n-  const handleNext = async () => {\r\n-    const currentStepValid = await form.trigger(getFieldsForStep(step));\r\n-    if (!currentStepValid) return;\r\n-\r\n-    if (step < steps.length - 1) {\r\n-      setStep((prev) => prev + 1);\r\n-    }\r\n-  };\r\n-\r\n-  const handleSubmit = form.handleSubmit(async (values) => {\r\n-    const isValid = await form.trigger();\r\n-    if (!isValid) return;\r\n-    setSubmitted(values);\r\n-  });\r\n-\r\n   return (\r\n-    <div className=\"grid gap-6 lg:grid-cols-[2fr_1fr]\">\r\n-      <Card\r\n-        title={steps[step].title}\r\n-        description={steps[step].description}\r\n-        actions={\r\n-          <Badge variant=\"info\">\r\n-            Step {step + 1} of {steps.length}\r\n-          </Badge>\r\n-        }\r\n-      >\r\n-        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n-          {step === 0 && (\r\n-            <PhaseSection label=\"Groundnut Intake\">\r\n-              <InputField\r\n-                label=\"Batch ID\"\r\n-                type=\"text\"\r\n-                {...form.register(\"batchId\")}\r\n-                error={form.formState.errors.batchId?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Farmer Name\"\r\n-                type=\"text\"\r\n-                {...form.register(\"farmerName\")}\r\n-                error={form.formState.errors.farmerName?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Date Pressed\"\r\n-                type=\"date\"\r\n-                {...form.register(\"pressedOn\")}\r\n-                error={form.formState.errors.pressedOn?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Input Groundnuts (kg)\"\r\n-                type=\"number\"\r\n-                step=\"0.1\"\r\n-                {...form.register(\"inputGroundnuts\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.inputGroundnuts?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Output Peanuts (kg)\"\r\n-                type=\"number\"\r\n-                step=\"0.1\"\r\n-                {...form.register(\"dehuskedPeanuts\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.dehuskedPeanuts?.message}\r\n-              />\r\n-            </PhaseSection>\r\n-          )}\r\n+    <div className=\"space-y-6\">\r\n+      <div>\r\n+        <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">Production Run Planner</h2>\r\n+        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n+          Log each stage to keep inventory, costing, and compliance aligned.\r\n+        </p>\r\n+      </div>\r\n \r\n-          {step === 1 && (\r\n-            <PhaseSection label=\"Cold Pressing Yield\">\r\n-              <AlertStat label=\"Expected Oil\" value={`${estimatedOilYield} L`} hint=\"Based on 62% conversion.\" />\r\n-              <InputField\r\n-                label=\"Oil Collected (L)\"\r\n-                type=\"number\"\r\n-                step=\"0.1\"\r\n-                {...form.register(\"pressingOil\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.pressingOil?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Oilcake (kg)\"\r\n-                type=\"number\"\r\n-                step=\"0.1\"\r\n-                {...form.register(\"pressingCake\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.pressingCake?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Husk (kg)\"\r\n-                type=\"number\"\r\n-                step=\"0.1\"\r\n-                {...form.register(\"pressingHusk\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.pressingHusk?.message}\r\n-              />\r\n-              {pendingLiters > 0 && <InlineHint message={`${pendingLiters} L yet to be pressed`} />}\r\n-            </PhaseSection>\r\n-          )}\r\n+      <ProductionWorkflowForm />\r\n \r\n-          {step === 2 && (\r\n-            <PhaseSection label=\"Bottling\">\r\n-              <InputField\r\n-                label=\"1L Bottles Filled\"\r\n-                type=\"number\"\r\n-                {...form.register(\"bottling1L\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.bottling1L?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"5L Tins Filled\"\r\n-                type=\"number\"\r\n-                {...form.register(\"bottling5L\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.bottling5L?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"15L Tins Filled\"\r\n-                type=\"number\"\r\n-                {...form.register(\"bottling15L\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.bottling15L?.message}\r\n-              />\r\n-              <InputField\r\n-                label=\"Labels Used\"\r\n-                type=\"number\"\r\n-                {...form.register(\"bottlingLabels\", { valueAsNumber: true })}\r\n-                error={form.formState.errors.bottlingLabels?.message}\r\n-              />\r\n-            </PhaseSection>\r\n-          )}\r\n-\r\n-          <div className=\"flex items-center justify-between\">\r\n-            <button\r\n-              type=\"button\"\r\n-              onClick={() => setStep((prev) => Math.max(prev - 1, 0))}\r\n-              className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 transition hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n-              disabled={step === 0}\r\n-            >\r\n-              Back\r\n-            </button>\r\n-            {step < steps.length - 1 ? (\r\n-              <button\r\n-                type=\"button\"\r\n-                onClick={handleNext}\r\n-                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n-              >\r\n-                Save & Next\r\n-              </button>\r\n-            ) : (\r\n-              <button\r\n-                type=\"submit\"\r\n-                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n-              >\r\n-                Complete Batch\r\n-              </button>\r\n-            )}\r\n-          </div>\r\n-        </form>\r\n+      <Card title=\"Upcoming Batches\" description=\"Align labor and procurement for the next 48 hours.\">\r\n+        <ul className=\"space-y-3 text-sm text-zinc-600 dark:text-zinc-300\">\r\n+          {upcoming.map((batch) => (\r\n+            <li key={batch.id} className=\"flex items-center justify-between\">\r\n+              <div>\r\n+                <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">{batch.id.toUpperCase()}</p>\r\n+                <p className=\"text-xs text-zinc-500\">\r\n+                  {batch.phase === \"pressing\" ? \"Pressing\" : \"De-husking\"} · Farmer: {batch.farmerName}\r\n+                </p>\r\n+              </div>\r\n+              <span className=\"text-xs text-zinc-500\">{new Date(batch.date).toLocaleString()}</span>\r\n+            </li>\r\n+          ))}\r\n+        </ul>\r\n       </Card>\r\n-\r\n-      <Card title=\"Batch Summary\" description=\"Auto-computed adjustments\">\r\n-        {submitted ? (\r\n-          <div className=\"space-y-4 text-sm text-zinc-600 dark:text-zinc-300\">\r\n-            <SummaryRow label=\"Batch\" value={submitted.batchId.toUpperCase()} />\r\n-            <SummaryRow label=\"Farmer\" value={submitted.farmerName} />\r\n-            <SummaryRow label=\"Input\" value={`${submitted.inputGroundnuts} kg groundnuts`} />\r\n-            <SummaryRow label=\"Peanuts\" value={`${submitted.dehuskedPeanuts} kg`} />\r\n-            <SummaryRow label=\"Oil\" value={`${submitted.pressingOil} L`} />\r\n-            <SummaryRow label=\"Oilcake\" value={`${submitted.pressingCake} kg`} />\r\n-            <SummaryRow label=\"Husk\" value={`${submitted.pressingHusk} kg`} />\r\n-            <SummaryRow\r\n-              label=\"Finished Goods\"\r\n-              value={`${submitted.bottling1L}×1L · ${submitted.bottling5L}×5L · ${submitted.bottling15L}×15L`}\r\n-            />\r\n-            <SummaryRow label=\"Labels Used\" value={`${submitted.bottlingLabels}`} />\r\n-          </div>\r\n-        ) : (\r\n-          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n-            Fill the steps on the left to preview inventory adjustments and batch log.\r\n-          </p>\r\n-        )}\r\n-      </Card>\r\n     </div>\r\n   );\r\n }\r\n-\r\n-function getFieldsForStep(step: number) {\r\n-  switch (step) {\r\n-    case 0:\r\n-      return [\"batchId\", \"farmerName\", \"pressedOn\", \"inputGroundnuts\", \"dehuskedPeanuts\"] as const;\r\n-    case 1:\r\n-      return [\"pressingOil\", \"pressingCake\", \"pressingHusk\"] as const;\r\n-    case 2:\r\n-      return [\"bottling1L\", \"bottling5L\", \"bottling15L\", \"bottlingLabels\"] as const;\r\n-    default:\r\n-      return [] as const;\r\n-  }\r\n-}\r\n-\r\n-interface PhaseSectionProps {\r\n-  label: string;\r\n-  children: React.ReactNode;\r\n-}\r\n-\r\n-function PhaseSection({ label, children }: PhaseSectionProps) {\r\n-  return (\r\n-    <fieldset className=\"space-y-4\">\r\n-      <legend className=\"text-sm font-semibold uppercase tracking-wide text-emerald-600 dark:text-emerald-300\">\r\n-        {label}\r\n-      </legend>\r\n-      {children}\r\n-    </fieldset>\r\n-  );\r\n-}\r\n-\r\n-interface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n-  label: string;\r\n-  error?: string;\r\n-}\r\n-\r\n-const InputField = ({ label, error, ...props }: InputFieldProps) => {\r\n-  return (\r\n-    <label className=\"block text-sm text-zinc-600 dark:text-zinc-300\">\r\n-      <span className=\"mb-1 block font-medium text-zinc-900 dark:text-zinc-100\">{label}</span>\r\n-      <input\r\n-        {...props}\r\n-        className=\"w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n-      />\r\n-      {error && <span className=\"mt-1 block text-xs text-rose-500\">{error}</span>}\r\n-    </label>\r\n-  );\r\n-};\r\n-\r\n-interface SummaryRowProps {\r\n-  label: string;\r\n-  value: string;\r\n-}\r\n-\r\n-function SummaryRow({ label, value }: SummaryRowProps) {\r\n-  return (\r\n-    <div className=\"flex items-center justify-between\">\r\n-      <span className=\"font-medium text-zinc-500 dark:text-zinc-400\">{label}</span>\r\n-      <span className=\"text-zinc-900 dark:text-zinc-100\">{value}</span>\r\n-    </div>\r\n-  );\r\n-}\r\n-\r\n-function AlertStat({ label, value, hint }: { label: string; value: string; hint?: string }) {\r\n-  return (\r\n-    <div className=\"rounded-lg border border-emerald-200 bg-emerald-50/70 p-3 text-sm font-medium text-emerald-700 dark:border-emerald-900/40 dark:bg-emerald-950/30 dark:text-emerald-200\">\r\n-      <div>{label}</div>\r\n-      <div className=\"text-lg font-semibold\">{value}</div>\r\n-      {hint && <p className=\"text-xs text-emerald-600/80 dark:text-emerald-200/70\">{hint}</p>}\r\n-    </div>\r\n-  );\r\n-}\r\n-\r\n-function InlineHint({ message }: { message: string }) {\r\n-  return <p className=\"text-xs font-medium text-amber-600 dark:text-amber-300\">{message}</p>;\r\n-}\r\n"
                },
                {
                    "date": 1763361124671,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,36 +1,529 @@\n-import { Card } from \"@/components/ui/card\";\r\n-import { ProductionWorkflowForm } from \"@/components/production/workflow-form\";\r\n-import { productionBatches } from \"@/lib/sample-data\";\r\n+\"use client\";\r\n \r\n-export default function ProductionPage() {\r\n-  const upcoming = productionBatches.filter((batch) => batch.phase !== \"bottling\");\r\n+import { useState, useEffect } from \"react\";\r\n+import { useForm } from \"react-hook-form\";\r\n+import { zodResolver } from \"@hookform/resolvers/zod\";\r\n+import { z } from \"zod\";\r\n+import { Badge } from \"@/components/ui/badge\";\r\n+import { updateProductionPhase } from \"@/app/actions/production\";\r\n+import { X } from \"lucide-react\";\r\n \r\n+const dehuskingSchema = z.object({\r\n+  input_groundnuts_kg: z.number().positive(),\r\n+  output_peanuts_kg: z.number().min(0),\r\n+  notes: z.string().optional(),\r\n+});\r\n+\r\n+const pressingSchema = z.object({\r\n+  output_oil_liters: z.number().min(0),\r\n+  output_oilcake_kg: z.number().min(0),\r\n+  output_husk_kg: z.number().min(0),\r\n+  notes: z.string().optional(),\r\n+});\r\n+\r\n+const bottlingSchema = z.object({\r\n+  bottled_units: z.number().min(0),\r\n+  notes: z.string().optional(),\r\n+});\r\n+\r\n+type DehuskingFormValues = z.infer<typeof dehuskingSchema>;\r\n+type PressingFormValues = z.infer<typeof pressingSchema>;\r\n+type BottlingFormValues = z.infer<typeof bottlingSchema>;\r\n+\r\n+type ProductionBatch = {\r\n+  id: string;\r\n+  batch_code: string;\r\n+  phase: \"dehusking\" | \"pressing\" | \"bottling\";\r\n+  farmer_name: string | null;\r\n+  batch_date: string;\r\n+  input_groundnuts_kg: number | null;\r\n+  output_peanuts_kg: number | null;\r\n+  output_oil_liters: number | null;\r\n+  output_oilcake_kg: number | null;\r\n+  output_husk_kg: number | null;\r\n+  bottled_units: number | null;\r\n+  notes: string | null;\r\n+};\r\n+\r\n+interface ProductionWorkflowFormProps {\r\n+  batch: ProductionBatch;\r\n+  onClose: () => void;\r\n+  onSuccess: () => void;\r\n+}\r\n+\r\n+export function ProductionWorkflowForm({\r\n+  batch,\r\n+  onClose,\r\n+  onSuccess,\r\n+}: ProductionWorkflowFormProps) {\r\n+  const [loading, setLoading] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+\r\n+  const phaseInfo = {\r\n+    dehusking: {\r\n+      title: \"Phase 1: De-husking\",\r\n+      description: \"Convert groundnuts to clean peanuts\",\r\n+      nextPhase: \"pressing\" as const,\r\n+    },\r\n+    pressing: {\r\n+      title: \"Phase 2: Pressing\",\r\n+      description: \"Extract oil and capture byproducts\",\r\n+      nextPhase: \"bottling\" as const,\r\n+    },\r\n+    bottling: {\r\n+      title: \"Phase 3: Bottling\",\r\n+      description: \"Package finished oil for sale\",\r\n+      nextPhase: \"completed\" as const,\r\n+    },\r\n+  };\r\n+\r\n+  const currentPhaseInfo = phaseInfo[batch.phase];\r\n+\r\n+  // Render appropriate form based on current phase\r\n+  if (batch.phase === \"dehusking\") {\r\n+    return (\r\n+      <DehuskingForm\r\n+        batch={batch}\r\n+        phaseInfo={currentPhaseInfo}\r\n+        onClose={onClose}\r\n+        onSuccess={onSuccess}\r\n+      />\r\n+    );\r\n+  } else if (batch.phase === \"pressing\") {\r\n+    return (\r\n+      <PressingForm\r\n+        batch={batch}\r\n+        phaseInfo={currentPhaseInfo}\r\n+        onClose={onClose}\r\n+        onSuccess={onSuccess}\r\n+      />\r\n+    );\r\n+  } else {\r\n+    return (\r\n+      <BottlingForm\r\n+        batch={batch}\r\n+        phaseInfo={currentPhaseInfo}\r\n+        onClose={onClose}\r\n+        onSuccess={onSuccess}\r\n+      />\r\n+    );\r\n+  }\r\n+}\r\n+\r\n+function DehuskingForm({\r\n+  batch,\r\n+  phaseInfo,\r\n+  onClose,\r\n+  onSuccess,\r\n+}: {\r\n+  batch: ProductionBatch;\r\n+  phaseInfo: any;\r\n+  onClose: () => void;\r\n+  onSuccess: () => void;\r\n+}) {\r\n+  const [loading, setLoading] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+\r\n+  const form = useForm<DehuskingFormValues>({\r\n+    resolver: zodResolver(dehuskingSchema),\r\n+    defaultValues: {\r\n+      input_groundnuts_kg: batch.input_groundnuts_kg || 0,\r\n+      output_peanuts_kg: batch.output_peanuts_kg || 0,\r\n+      notes: batch.notes || \"\",\r\n+    },\r\n+  });\r\n+\r\n+  const handleSubmit = form.handleSubmit(async (values) => {\r\n+    setLoading(true);\r\n+    setError(null);\r\n+\r\n+    const result = await updateProductionPhase(\r\n+      batch.id,\r\n+      {\r\n+        phase: \"dehusking\",\r\n+        input_groundnuts_kg: values.input_groundnuts_kg,\r\n+        output_peanuts_kg: values.output_peanuts_kg,\r\n+        notes: values.notes,\r\n+      },\r\n+      phaseInfo.nextPhase\r\n+    );\r\n+\r\n+    if (result.success) {\r\n+      onSuccess();\r\n+    } else {\r\n+      setError(result.error || \"Failed to update batch\");\r\n+    }\r\n+    setLoading(false);\r\n+  });\r\n+\r\n   return (\r\n-    <div className=\"space-y-6\">\r\n-      <div>\r\n-        <h2 className=\"text-2xl font-semibold text-zinc-900 dark:text-zinc-100\">Production Run Planner</h2>\r\n-        <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n-          Log each stage to keep inventory, costing, and compliance aligned.\r\n-        </p>\r\n+    <FormModal\r\n+      title={phaseInfo.title}\r\n+      description={phaseInfo.description}\r\n+      batch={batch}\r\n+      onClose={onClose}\r\n+      error={error}\r\n+    >\r\n+      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n+        <InputField\r\n+          label=\"Input Groundnuts (kg)\"\r\n+          type=\"number\"\r\n+          step=\"0.1\"\r\n+          {...form.register(\"input_groundnuts_kg\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.input_groundnuts_kg?.message}\r\n+        />\r\n+\r\n+        <InputField\r\n+          label=\"Output Peanuts (kg)\"\r\n+          type=\"number\"\r\n+          step=\"0.1\"\r\n+          {...form.register(\"output_peanuts_kg\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.output_peanuts_kg?.message}\r\n+        />\r\n+\r\n+        <div>\r\n+          <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+            Notes\r\n+          </label>\r\n+          <textarea\r\n+            {...form.register(\"notes\")}\r\n+            rows={3}\r\n+            className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n+          />\r\n+        </div>\r\n+\r\n+        <div className=\"flex justify-end gap-3 pt-4\">\r\n+          <button\r\n+            type=\"button\"\r\n+            onClick={onClose}\r\n+            disabled={loading}\r\n+            className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n+          >\r\n+            Cancel\r\n+          </button>\r\n+          <button\r\n+            type=\"submit\"\r\n+            disabled={loading}\r\n+            className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n+          >\r\n+            {loading ? \"Saving...\" : \"Save & Advance to Pressing\"}\r\n+          </button>\r\n+        </div>\r\n+      </form>\r\n+    </FormModal>\r\n+  );\r\n+}\r\n+\r\n+function PressingForm({\r\n+  batch,\r\n+  phaseInfo,\r\n+  onClose,\r\n+  onSuccess,\r\n+}: {\r\n+  batch: ProductionBatch;\r\n+  phaseInfo: any;\r\n+  onClose: () => void;\r\n+  onSuccess: () => void;\r\n+}) {\r\n+  const [loading, setLoading] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+\r\n+  const form = useForm<PressingFormValues>({\r\n+    resolver: zodResolver(pressingSchema),\r\n+    defaultValues: {\r\n+      output_oil_liters: batch.output_oil_liters || 0,\r\n+      output_oilcake_kg: batch.output_oilcake_kg || 0,\r\n+      output_husk_kg: batch.output_husk_kg || 0,\r\n+      notes: batch.notes || \"\",\r\n+    },\r\n+  });\r\n+\r\n+  const handleSubmit = form.handleSubmit(async (values) => {\r\n+    setLoading(true);\r\n+    setError(null);\r\n+\r\n+    const result = await updateProductionPhase(\r\n+      batch.id,\r\n+      {\r\n+        phase: \"pressing\",\r\n+        output_oil_liters: values.output_oil_liters,\r\n+        output_oilcake_kg: values.output_oilcake_kg,\r\n+        output_husk_kg: values.output_husk_kg,\r\n+        output_peanuts_kg: batch.output_peanuts_kg || 0,\r\n+        notes: values.notes,\r\n+      },\r\n+      phaseInfo.nextPhase\r\n+    );\r\n+\r\n+    if (result.success) {\r\n+      onSuccess();\r\n+    } else {\r\n+      setError(result.error || \"Failed to update batch\");\r\n+    }\r\n+    setLoading(false);\r\n+  });\r\n+\r\n+  const estimatedOilYield = batch.output_peanuts_kg\r\n+    ? Math.round(batch.output_peanuts_kg * 0.62)\r\n+    : 0;\r\n+\r\n+  return (\r\n+    <FormModal\r\n+      title={phaseInfo.title}\r\n+      description={phaseInfo.description}\r\n+      batch={batch}\r\n+      onClose={onClose}\r\n+      error={error}\r\n+    >\r\n+      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n+        {estimatedOilYield > 0 && (\r\n+          <div className=\"rounded-lg border border-emerald-200 bg-emerald-50/70 p-3 text-sm dark:border-emerald-900/40 dark:bg-emerald-950/30\">\r\n+            <p className=\"font-medium text-emerald-800 dark:text-emerald-200\">\r\n+              Expected Oil Yield\r\n+            </p>\r\n+            <p className=\"text-lg font-semibold text-emerald-700 dark:text-emerald-100\">\r\n+              {estimatedOilYield} L\r\n+            </p>\r\n+            <p className=\"text-xs text-emerald-600/80 dark:text-emerald-200/70\">\r\n+              Based on {batch.output_peanuts_kg} kg peanuts (62% conversion)\r\n+            </p>\r\n+          </div>\r\n+        )}\r\n+\r\n+        <InputField\r\n+          label=\"Oil Collected (L)\"\r\n+          type=\"number\"\r\n+          step=\"0.1\"\r\n+          {...form.register(\"output_oil_liters\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.output_oil_liters?.message}\r\n+        />\r\n+\r\n+        <InputField\r\n+          label=\"Oilcake (kg)\"\r\n+          type=\"number\"\r\n+          step=\"0.1\"\r\n+          {...form.register(\"output_oilcake_kg\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.output_oilcake_kg?.message}\r\n+        />\r\n+\r\n+        <InputField\r\n+          label=\"Husk (kg)\"\r\n+          type=\"number\"\r\n+          step=\"0.1\"\r\n+          {...form.register(\"output_husk_kg\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.output_husk_kg?.message}\r\n+        />\r\n+\r\n+        <div>\r\n+          <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+            Notes\r\n+          </label>\r\n+          <textarea\r\n+            {...form.register(\"notes\")}\r\n+            rows={3}\r\n+            className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n+          />\r\n+        </div>\r\n+\r\n+        <div className=\"flex justify-end gap-3 pt-4\">\r\n+          <button\r\n+            type=\"button\"\r\n+            onClick={onClose}\r\n+            disabled={loading}\r\n+            className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n+          >\r\n+            Cancel\r\n+          </button>\r\n+          <button\r\n+            type=\"submit\"\r\n+            disabled={loading}\r\n+            className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n+          >\r\n+            {loading ? \"Saving...\" : \"Save & Advance to Bottling\"}\r\n+          </button>\r\n+        </div>\r\n+      </form>\r\n+    </FormModal>\r\n+  );\r\n+}\r\n+\r\n+function BottlingForm({\r\n+  batch,\r\n+  phaseInfo,\r\n+  onClose,\r\n+  onSuccess,\r\n+}: {\r\n+  batch: ProductionBatch;\r\n+  phaseInfo: any;\r\n+  onClose: () => void;\r\n+  onSuccess: () => void;\r\n+}) {\r\n+  const [loading, setLoading] = useState(false);\r\n+  const [error, setError] = useState<string | null>(null);\r\n+\r\n+  const form = useForm<BottlingFormValues>({\r\n+    resolver: zodResolver(bottlingSchema),\r\n+    defaultValues: {\r\n+      bottled_units: batch.bottled_units || 0,\r\n+      notes: batch.notes || \"\",\r\n+    },\r\n+  });\r\n+\r\n+  const handleSubmit = form.handleSubmit(async (values) => {\r\n+    setLoading(true);\r\n+    setError(null);\r\n+\r\n+    const result = await updateProductionPhase(\r\n+      batch.id,\r\n+      {\r\n+        phase: \"bottling\",\r\n+        bottled_units: values.bottled_units,\r\n+        output_oil_liters: batch.output_oil_liters || 0,\r\n+        notes: values.notes,\r\n+      },\r\n+      phaseInfo.nextPhase\r\n+    );\r\n+\r\n+    if (result.success) {\r\n+      onSuccess();\r\n+    } else {\r\n+      setError(result.error || \"Failed to update batch\");\r\n+    }\r\n+    setLoading(false);\r\n+  });\r\n+\r\n+  return (\r\n+    <FormModal\r\n+      title={phaseInfo.title}\r\n+      description={phaseInfo.description}\r\n+      batch={batch}\r\n+      onClose={onClose}\r\n+      error={error}\r\n+    >\r\n+      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n+        {batch.output_oil_liters && (\r\n+          <div className=\"rounded-lg border border-blue-200 bg-blue-50/70 p-3 text-sm dark:border-blue-900/40 dark:bg-blue-950/30\">\r\n+            <p className=\"font-medium text-blue-800 dark:text-blue-200\">\r\n+              Available Oil\r\n+            </p>\r\n+            <p className=\"text-lg font-semibold text-blue-700 dark:text-blue-100\">\r\n+              {batch.output_oil_liters} L\r\n+            </p>\r\n+          </div>\r\n+        )}\r\n+\r\n+        <InputField\r\n+          label=\"Bottles Filled (1L units)\"\r\n+          type=\"number\"\r\n+          {...form.register(\"bottled_units\", { valueAsNumber: true })}\r\n+          error={form.formState.errors.bottled_units?.message}\r\n+        />\r\n+\r\n+        <div>\r\n+          <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+            Notes\r\n+          </label>\r\n+          <textarea\r\n+            {...form.register(\"notes\")}\r\n+            rows={3}\r\n+            className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n+          />\r\n+        </div>\r\n+\r\n+        <div className=\"flex justify-end gap-3 pt-4\">\r\n+          <button\r\n+            type=\"button\"\r\n+            onClick={onClose}\r\n+            disabled={loading}\r\n+            className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n+          >\r\n+            Cancel\r\n+          </button>\r\n+          <button\r\n+            type=\"submit\"\r\n+            disabled={loading}\r\n+            className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n+          >\r\n+            {loading ? \"Saving...\" : \"Complete Batch\"}\r\n+          </button>\r\n+        </div>\r\n+      </form>\r\n+    </FormModal>\r\n+  );\r\n+}\r\n+\r\n+function FormModal({\r\n+  title,\r\n+  description,\r\n+  batch,\r\n+  onClose,\r\n+  error,\r\n+  children,\r\n+}: {\r\n+  title: string;\r\n+  description: string;\r\n+  batch: ProductionBatch;\r\n+  onClose: () => void;\r\n+  error: string | null;\r\n+  children: React.ReactNode;\r\n+}) {\r\n+  return (\r\n+    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n+      <div className=\"w-full max-w-2xl rounded-lg bg-white shadow-xl dark:bg-zinc-900\">\r\n+        <div className=\"flex items-start justify-between border-b border-zinc-200 p-6 dark:border-zinc-800\">\r\n+          <div className=\"flex-1\">\r\n+            <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\r\n+              {title}\r\n+            </h3>\r\n+            <p className=\"mt-1 text-sm text-zinc-500 dark:text-zinc-400\">\r\n+              {description}\r\n+            </p>\r\n+            <div className=\"mt-3 flex items-center gap-3\">\r\n+              <Badge variant=\"info\">{batch.batch_code.toUpperCase()}</Badge>\r\n+              {batch.farmer_name && (\r\n+                <span className=\"text-sm text-zinc-500\">\r\n+                  Farmer: {batch.farmer_name}\r\n+                </span>\r\n+              )}\r\n+            </div>\r\n+          </div>\r\n+          <button\r\n+            onClick={onClose}\r\n+            className=\"rounded-lg p-2 text-zinc-500 hover:bg-zinc-100 dark:hover:bg-zinc-800\"\r\n+          >\r\n+            <X size={20} />\r\n+          </button>\r\n+        </div>\r\n+\r\n+        <div className=\"p-6\">\r\n+          {error && (\r\n+            <div className=\"mb-4 rounded-lg bg-rose-50 p-3 text-sm text-rose-700 dark:bg-rose-900/20 dark:text-rose-400\">\r\n+              {error}\r\n+            </div>\r\n+          )}\r\n+          {children}\r\n+        </div>\r\n       </div>\r\n+    </div>\r\n+  );\r\n+}\r\n \r\n-      <ProductionWorkflowForm />\r\n+interface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n+  label: string;\r\n+  error?: string;\r\n+}\r\n \r\n-      <Card title=\"Upcoming Batches\" description=\"Align labor and procurement for the next 48 hours.\">\r\n-        <ul className=\"space-y-3 text-sm text-zinc-600 dark:text-zinc-300\">\r\n-          {upcoming.map((batch) => (\r\n-            <li key={batch.id} className=\"flex items-center justify-between\">\r\n-              <div>\r\n-                <p className=\"font-semibold text-zinc-900 dark:text-zinc-100\">{batch.id.toUpperCase()}</p>\r\n-                <p className=\"text-xs text-zinc-500\">\r\n-                  {batch.phase === \"pressing\" ? \"Pressing\" : \"De-husking\"} · Farmer: {batch.farmerName}\r\n-                </p>\r\n-              </div>\r\n-              <span className=\"text-xs text-zinc-500\">{new Date(batch.date).toLocaleString()}</span>\r\n-            </li>\r\n-          ))}\r\n-        </ul>\r\n-      </Card>\r\n+const InputField = ({ label, error, ...props }: InputFieldProps) => {\r\n+  return (\r\n+    <div>\r\n+      <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n+        {label}\r\n+      </label>\r\n+      <input\r\n+        {...props}\r\n+        className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n+      />\r\n+      {error && <span className=\"mt-1 block text-xs text-rose-500\">{error}</span>}\r\n     </div>\r\n   );\r\n-}\r\n+};\n\\ No newline at end of file\n"
                },
                {
                    "date": 1763364745358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,29 +20,22 @@\n   output_husk_kg: z.number().min(0),\r\n   notes: z.string().optional(),\r\n });\r\n \r\n-const bottlingSchema = z.object({\r\n-  bottled_units: z.number().min(0),\r\n-  notes: z.string().optional(),\r\n-});\r\n-\r\n type DehuskingFormValues = z.infer<typeof dehuskingSchema>;\r\n type PressingFormValues = z.infer<typeof pressingSchema>;\r\n-type BottlingFormValues = z.infer<typeof bottlingSchema>;\r\n \r\n type ProductionBatch = {\r\n   id: string;\r\n   batch_code: string;\r\n-  phase: \"dehusking\" | \"pressing\" | \"bottling\";\r\n+  phase: \"dehusking\" | \"pressing\" | \"completed\";\r\n   farmer_name: string | null;\r\n   batch_date: string;\r\n   input_groundnuts_kg: number | null;\r\n   output_peanuts_kg: number | null;\r\n   output_oil_liters: number | null;\r\n   output_oilcake_kg: number | null;\r\n   output_husk_kg: number | null;\r\n-  bottled_units: number | null;\r\n   notes: string | null;\r\n };\r\n \r\n interface ProductionWorkflowFormProps {\r\n@@ -67,19 +60,32 @@\n     },\r\n     pressing: {\r\n       title: \"Phase 2: Pressing\",\r\n       description: \"Extract oil and capture byproducts\",\r\n-      nextPhase: \"bottling\" as const,\r\n-    },\r\n-    bottling: {\r\n-      title: \"Phase 3: Bottling\",\r\n-      description: \"Package finished oil for sale\",\r\n       nextPhase: \"completed\" as const,\r\n     },\r\n   };\r\n \r\n-  const currentPhaseInfo = phaseInfo[batch.phase];\r\n+  const currentPhaseInfo = phaseInfo[batch.phase as keyof typeof phaseInfo];\r\n \r\n+  // Only allow editing for dehusking and pressing phases\r\n+  if (batch.phase === \"completed\") {\r\n+    return (\r\n+      <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n+        <div className=\"w-full max-w-md rounded-lg bg-white p-6 shadow-xl dark:bg-zinc-900\">\r\n+          <h3 className=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">Batch Completed</h3>\r\n+          <p className=\"mt-2 text-sm text-zinc-500\">This batch has been completed and cannot be edited.</p>\r\n+          <button\r\n+            onClick={onClose}\r\n+            className=\"mt-4 w-full rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500\"\r\n+          >\r\n+            Close\r\n+          </button>\r\n+        </div>\r\n+      </div>\r\n+    );\r\n+  }\r\n+\r\n   // Render appropriate form based on current phase\r\n   if (batch.phase === \"dehusking\") {\r\n     return (\r\n       <DehuskingForm\r\n@@ -97,18 +103,11 @@\n         onClose={onClose}\r\n         onSuccess={onSuccess}\r\n       />\r\n     );\r\n-  } else {\r\n-    return (\r\n-      <BottlingForm\r\n-        batch={batch}\r\n-        phaseInfo={currentPhaseInfo}\r\n-        onClose={onClose}\r\n-        onSuccess={onSuccess}\r\n-      />\r\n-    );\r\n   }\r\n+\r\n+  return null;\r\n }\r\n \r\n function DehuskingForm({\r\n   batch,\r\n@@ -338,121 +337,16 @@\n             type=\"submit\"\r\n             disabled={loading}\r\n             className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n           >\r\n-            {loading ? \"Saving...\" : \"Save & Advance to Bottling\"}\r\n+            {loading ? \"Saving...\" : \"Save & Complete Batch\"}\r\n           </button>\r\n         </div>\r\n       </form>\r\n     </FormModal>\r\n   );\r\n }\r\n \r\n-function BottlingForm({\r\n-  batch,\r\n-  phaseInfo,\r\n-  onClose,\r\n-  onSuccess,\r\n-}: {\r\n-  batch: ProductionBatch;\r\n-  phaseInfo: any;\r\n-  onClose: () => void;\r\n-  onSuccess: () => void;\r\n-}) {\r\n-  const [loading, setLoading] = useState(false);\r\n-  const [error, setError] = useState<string | null>(null);\r\n-\r\n-  const form = useForm<BottlingFormValues>({\r\n-    resolver: zodResolver(bottlingSchema),\r\n-    defaultValues: {\r\n-      bottled_units: batch.bottled_units || 0,\r\n-      notes: batch.notes || \"\",\r\n-    },\r\n-  });\r\n-\r\n-  const handleSubmit = form.handleSubmit(async (values) => {\r\n-    setLoading(true);\r\n-    setError(null);\r\n-\r\n-    const result = await updateProductionPhase(\r\n-      batch.id,\r\n-      {\r\n-        phase: \"bottling\",\r\n-        bottled_units: values.bottled_units,\r\n-        output_oil_liters: batch.output_oil_liters || 0,\r\n-        notes: values.notes,\r\n-      },\r\n-      phaseInfo.nextPhase\r\n-    );\r\n-\r\n-    if (result.success) {\r\n-      onSuccess();\r\n-    } else {\r\n-      setError(result.error || \"Failed to update batch\");\r\n-    }\r\n-    setLoading(false);\r\n-  });\r\n-\r\n-  return (\r\n-    <FormModal\r\n-      title={phaseInfo.title}\r\n-      description={phaseInfo.description}\r\n-      batch={batch}\r\n-      onClose={onClose}\r\n-      error={error}\r\n-    >\r\n-      <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n-        {batch.output_oil_liters && (\r\n-          <div className=\"rounded-lg border border-blue-200 bg-blue-50/70 p-3 text-sm dark:border-blue-900/40 dark:bg-blue-950/30\">\r\n-            <p className=\"font-medium text-blue-800 dark:text-blue-200\">\r\n-              Available Oil\r\n-            </p>\r\n-            <p className=\"text-lg font-semibold text-blue-700 dark:text-blue-100\">\r\n-              {batch.output_oil_liters} L\r\n-            </p>\r\n-          </div>\r\n-        )}\r\n-\r\n-        <InputField\r\n-          label=\"Bottles Filled (1L units)\"\r\n-          type=\"number\"\r\n-          {...form.register(\"bottled_units\", { valueAsNumber: true })}\r\n-          error={form.formState.errors.bottled_units?.message}\r\n-        />\r\n-\r\n-        <div>\r\n-          <label className=\"block text-sm font-medium text-zinc-900 dark:text-zinc-100\">\r\n-            Notes\r\n-          </label>\r\n-          <textarea\r\n-            {...form.register(\"notes\")}\r\n-            rows={3}\r\n-            className=\"mt-1 w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-800 dark:text-zinc-100\"\r\n-          />\r\n-        </div>\r\n-\r\n-        <div className=\"flex justify-end gap-3 pt-4\">\r\n-          <button\r\n-            type=\"button\"\r\n-            onClick={onClose}\r\n-            disabled={loading}\r\n-            className=\"rounded-lg px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n-          >\r\n-            Cancel\r\n-          </button>\r\n-          <button\r\n-            type=\"submit\"\r\n-            disabled={loading}\r\n-            className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500 disabled:opacity-50\"\r\n-          >\r\n-            {loading ? \"Saving...\" : \"Complete Batch\"}\r\n-          </button>\r\n-        </div>\r\n-      </form>\r\n-    </FormModal>\r\n-  );\r\n-}\r\n-\r\n function FormModal({\r\n   title,\r\n   description,\r\n   batch,\r\n"
                }
            ],
            "date": 1763069565217,
            "name": "Commit-0",
            "content": "\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\nimport { useForm, useWatch } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { z } from \"zod\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card } from \"@/components/ui/card\";\r\n\r\nconst productionSchema = z.object({\r\n  batchId: z.string().min(1),\r\n  farmerName: z.string().min(1),\r\n  pressedOn: z.string().min(1),\r\n  inputGroundnuts: z.number().positive(),\r\n  dehuskedPeanuts: z.number().min(0),\r\n  pressingOil: z.number().min(0),\r\n  pressingCake: z.number().min(0),\r\n  pressingHusk: z.number().min(0),\r\n  bottling1L: z.number().min(0),\r\n  bottling5L: z.number().min(0),\r\n  bottling15L: z.number().min(0),\r\n  bottlingLabels: z.number().min(0),\r\n});\r\n\r\nexport type ProductionFormValues = z.infer<typeof productionSchema>;\r\n\r\nconst steps = [\r\n  { id: \"dehusking\", title: \"Phase 1 · De-husking\", description: \"Convert groundnuts to clean peanuts.\" },\r\n  { id: \"pressing\", title: \"Phase 2 · Pressing\", description: \"Capture oil and byproducts.\" },\r\n  { id: \"bottling\", title: \"Phase 3 · Bottling\", description: \"Package finished oil for sale.\" },\r\n];\r\n\r\nexport function ProductionWorkflowForm() {\r\n  const [step, setStep] = useState(0);\r\n  const [submitted, setSubmitted] = useState<ProductionFormValues | null>(null);\r\n\r\n  const form = useForm<ProductionFormValues>({\r\n    resolver: zodResolver(productionSchema),\r\n    defaultValues: {\r\n      batchId: \"batch-24d\",\r\n      farmerName: \"Aravind Farms\",\r\n      pressedOn: new Date().toISOString().split(\"T\")[0],\r\n      inputGroundnuts: 280,\r\n      dehuskedPeanuts: 0,\r\n      pressingOil: 0,\r\n      pressingCake: 0,\r\n      pressingHusk: 0,\r\n      bottling1L: 0,\r\n      bottling5L: 0,\r\n      bottling15L: 0,\r\n      bottlingLabels: 0,\r\n    },\r\n  });\r\n\r\n  const dehuskedPeanuts = (useWatch({ control: form.control, name: \"dehuskedPeanuts\" }) as number | undefined) ?? 0;\r\n  const pressingOil = (useWatch({ control: form.control, name: \"pressingOil\" }) as number | undefined) ?? 0;\r\n\r\n  const estimatedOilYield = useMemo(() => {\r\n    if (dehuskedPeanuts <= 0) return 0;\r\n    return Math.round(dehuskedPeanuts * 0.62);\r\n  }, [dehuskedPeanuts]);\r\n\r\n  const pendingLiters = Math.max(estimatedOilYield - pressingOil, 0);\r\n\r\n  const handleNext = async () => {\r\n    const currentStepValid = await form.trigger(getFieldsForStep(step));\r\n    if (!currentStepValid) return;\r\n\r\n    if (step < steps.length - 1) {\r\n      setStep((prev) => prev + 1);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = form.handleSubmit(async (values) => {\r\n    const isValid = await form.trigger();\r\n    if (!isValid) return;\r\n    setSubmitted(values);\r\n  });\r\n\r\n  return (\r\n    <div className=\"grid gap-6 lg:grid-cols-[2fr_1fr]\">\r\n      <Card\r\n        title={steps[step].title}\r\n        description={steps[step].description}\r\n        actions={\r\n          <Badge variant=\"info\">\r\n            Step {step + 1} of {steps.length}\r\n          </Badge>\r\n        }\r\n      >\r\n        <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n          {step === 0 && (\r\n            <PhaseSection label=\"Groundnut Intake\">\r\n              <InputField\r\n                label=\"Batch ID\"\r\n                type=\"text\"\r\n                {...form.register(\"batchId\")}\r\n                error={form.formState.errors.batchId?.message}\r\n              />\r\n              <InputField\r\n                label=\"Farmer Name\"\r\n                type=\"text\"\r\n                {...form.register(\"farmerName\")}\r\n                error={form.formState.errors.farmerName?.message}\r\n              />\r\n              <InputField\r\n                label=\"Date Pressed\"\r\n                type=\"date\"\r\n                {...form.register(\"pressedOn\")}\r\n                error={form.formState.errors.pressedOn?.message}\r\n              />\r\n              <InputField\r\n                label=\"Input Groundnuts (kg)\"\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                {...form.register(\"inputGroundnuts\", { valueAsNumber: true })}\r\n                error={form.formState.errors.inputGroundnuts?.message}\r\n              />\r\n              <InputField\r\n                label=\"Output Peanuts (kg)\"\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                {...form.register(\"dehuskedPeanuts\", { valueAsNumber: true })}\r\n                error={form.formState.errors.dehuskedPeanuts?.message}\r\n              />\r\n            </PhaseSection>\r\n          )}\r\n\r\n          {step === 1 && (\r\n            <PhaseSection label=\"Cold Pressing Yield\">\r\n              <AlertStat label=\"Expected Oil\" value={`${estimatedOilYield} L`} hint=\"Based on 62% conversion.\" />\r\n              <InputField\r\n                label=\"Oil Collected (L)\"\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                {...form.register(\"pressingOil\", { valueAsNumber: true })}\r\n                error={form.formState.errors.pressingOil?.message}\r\n              />\r\n              <InputField\r\n                label=\"Oilcake (kg)\"\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                {...form.register(\"pressingCake\", { valueAsNumber: true })}\r\n                error={form.formState.errors.pressingCake?.message}\r\n              />\r\n              <InputField\r\n                label=\"Husk (kg)\"\r\n                type=\"number\"\r\n                step=\"0.1\"\r\n                {...form.register(\"pressingHusk\", { valueAsNumber: true })}\r\n                error={form.formState.errors.pressingHusk?.message}\r\n              />\r\n              {pendingLiters > 0 && <InlineHint message={`${pendingLiters} L yet to be pressed`} />}\r\n            </PhaseSection>\r\n          )}\r\n\r\n          {step === 2 && (\r\n            <PhaseSection label=\"Bottling\">\r\n              <InputField\r\n                label=\"1L Bottles Filled\"\r\n                type=\"number\"\r\n                {...form.register(\"bottling1L\", { valueAsNumber: true })}\r\n                error={form.formState.errors.bottling1L?.message}\r\n              />\r\n              <InputField\r\n                label=\"5L Tins Filled\"\r\n                type=\"number\"\r\n                {...form.register(\"bottling5L\", { valueAsNumber: true })}\r\n                error={form.formState.errors.bottling5L?.message}\r\n              />\r\n              <InputField\r\n                label=\"15L Tins Filled\"\r\n                type=\"number\"\r\n                {...form.register(\"bottling15L\", { valueAsNumber: true })}\r\n                error={form.formState.errors.bottling15L?.message}\r\n              />\r\n              <InputField\r\n                label=\"Labels Used\"\r\n                type=\"number\"\r\n                {...form.register(\"bottlingLabels\", { valueAsNumber: true })}\r\n                error={form.formState.errors.bottlingLabels?.message}\r\n              />\r\n            </PhaseSection>\r\n          )}\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={() => setStep((prev) => Math.max(prev - 1, 0))}\r\n              className=\"rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-600 transition hover:bg-zinc-100 dark:border-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-800\"\r\n              disabled={step === 0}\r\n            >\r\n              Back\r\n            </button>\r\n            {step < steps.length - 1 ? (\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleNext}\r\n                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n              >\r\n                Save & Next\r\n              </button>\r\n            ) : (\r\n              <button\r\n                type=\"submit\"\r\n                className=\"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-500\"\r\n              >\r\n                Complete Batch\r\n              </button>\r\n            )}\r\n          </div>\r\n        </form>\r\n      </Card>\r\n\r\n      <Card title=\"Batch Summary\" description=\"Auto-computed adjustments\">\r\n        {submitted ? (\r\n          <div className=\"space-y-4 text-sm text-zinc-600 dark:text-zinc-300\">\r\n            <SummaryRow label=\"Batch\" value={submitted.batchId.toUpperCase()} />\r\n            <SummaryRow label=\"Farmer\" value={submitted.farmerName} />\r\n            <SummaryRow label=\"Input\" value={`${submitted.inputGroundnuts} kg groundnuts`} />\r\n            <SummaryRow label=\"Peanuts\" value={`${submitted.dehuskedPeanuts} kg`} />\r\n            <SummaryRow label=\"Oil\" value={`${submitted.pressingOil} L`} />\r\n            <SummaryRow label=\"Oilcake\" value={`${submitted.pressingCake} kg`} />\r\n            <SummaryRow label=\"Husk\" value={`${submitted.pressingHusk} kg`} />\r\n            <SummaryRow\r\n              label=\"Finished Goods\"\r\n              value={`${submitted.bottling1L}×1L · ${submitted.bottling5L}×5L · ${submitted.bottling15L}×15L`}\r\n            />\r\n            <SummaryRow label=\"Labels Used\" value={`${submitted.bottlingLabels}`} />\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-sm text-zinc-500 dark:text-zinc-400\">\r\n            Fill the steps on the left to preview inventory adjustments and batch log.\r\n          </p>\r\n        )}\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction getFieldsForStep(step: number) {\r\n  switch (step) {\r\n    case 0:\r\n      return [\"batchId\", \"farmerName\", \"pressedOn\", \"inputGroundnuts\", \"dehuskedPeanuts\"] as const;\r\n    case 1:\r\n      return [\"pressingOil\", \"pressingCake\", \"pressingHusk\"] as const;\r\n    case 2:\r\n      return [\"bottling1L\", \"bottling5L\", \"bottling15L\", \"bottlingLabels\"] as const;\r\n    default:\r\n      return [] as const;\r\n  }\r\n}\r\n\r\ninterface PhaseSectionProps {\r\n  label: string;\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction PhaseSection({ label, children }: PhaseSectionProps) {\r\n  return (\r\n    <fieldset className=\"space-y-4\">\r\n      <legend className=\"text-sm font-semibold uppercase tracking-wide text-emerald-600 dark:text-emerald-300\">\r\n        {label}\r\n      </legend>\r\n      {children}\r\n    </fieldset>\r\n  );\r\n}\r\n\r\ninterface InputFieldProps extends React.InputHTMLAttributes<HTMLInputElement> {\r\n  label: string;\r\n  error?: string;\r\n}\r\n\r\nconst InputField = ({ label, error, ...props }: InputFieldProps) => {\r\n  return (\r\n    <label className=\"block text-sm text-zinc-600 dark:text-zinc-300\">\r\n      <span className=\"mb-1 block font-medium text-zinc-900 dark:text-zinc-100\">{label}</span>\r\n      <input\r\n        {...props}\r\n        className=\"w-full rounded-lg border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 shadow-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200 dark:border-zinc-700 dark:bg-zinc-900 dark:text-zinc-100\"\r\n      />\r\n      {error && <span className=\"mt-1 block text-xs text-rose-500\">{error}</span>}\r\n    </label>\r\n  );\r\n};\r\n\r\ninterface SummaryRowProps {\r\n  label: string;\r\n  value: string;\r\n}\r\n\r\nfunction SummaryRow({ label, value }: SummaryRowProps) {\r\n  return (\r\n    <div className=\"flex items-center justify-between\">\r\n      <span className=\"font-medium text-zinc-500 dark:text-zinc-400\">{label}</span>\r\n      <span className=\"text-zinc-900 dark:text-zinc-100\">{value}</span>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction AlertStat({ label, value, hint }: { label: string; value: string; hint?: string }) {\r\n  return (\r\n    <div className=\"rounded-lg border border-emerald-200 bg-emerald-50/70 p-3 text-sm font-medium text-emerald-700 dark:border-emerald-900/40 dark:bg-emerald-950/30 dark:text-emerald-200\">\r\n      <div>{label}</div>\r\n      <div className=\"text-lg font-semibold\">{value}</div>\r\n      {hint && <p className=\"text-xs text-emerald-600/80 dark:text-emerald-200/70\">{hint}</p>}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction InlineHint({ message }: { message: string }) {\r\n  return <p className=\"text-xs font-medium text-amber-600 dark:text-amber-300\">{message}</p>;\r\n}\r\n"
        }
    ]
}